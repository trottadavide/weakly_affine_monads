\documentclass[a4paper,UKenglish,numberwithinsect,cleveref, autoref, thm-restate]{lipics-v2021}

\bibliographystyle{plain} % the mandatory bibstyle


%\usepackage{natbib}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{float}
\usepackage{amsfonts}
\usepackage{amssymb}
\include{macro_davide}
\usepackage{mathtools}
\usepackage{quiver}
\usepackage{cleveref}
\usepackage{hyperref}
\usepackage{xcolor}
\usepackage[all,2cell]{xy}
\UseAllTwocells
\xyoption{v2}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{tikz}
\usepackage{tikzit}

\usetikzlibrary{shapes}

%\input{sample.tikzstyle}
\usepackage{freetikz}
\usetikzlibrary{decorations.markings,positioning,patterns}
\usetikzlibrary{shadows}
\usepackage{array}

%\usetikzlibrary{automata, positioning, arrows}
\input{stringdiagrams.tikzstyles}
\usepackage{todonotes}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\theoremstyle{plain} %italico
\newtheorem{mytheorem}{Theorem}[section]
\newtheorem{mycorollary}[mytheorem]{Corollary}
\newtheorem{mylemma}[mytheorem]{Lemma}
\newtheorem{myproposition}[mytheorem]{Proposition}


\theoremstyle{definition} %stampatello
\newtheorem{mydefinition}[mytheorem]{Definition}
\newtheorem{myproblem}[mytheorem]{Problem}

\newtheorem{myremark}[mytheorem]{Remark}
\newtheorem{myexample}[mytheorem]{Example}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\stringdiagnabla}[1]{\begin{tikzpicture}[scale=0.60, transform shape]
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-4.25, 0) {};
		\node [style=none] (1) at (-2.75, 0.5) {};
		\node [style=none] (2) at (-2.75, -0.5) {};
		\node [style=none] (3) at (-2, -0.5) {};
		\node [style=none] (4) at (-2, 0.5) {};
		\node [style=nodonero] (5) at (-3.25, 0) {};
		\node [style=none] (7) at (-3.75, 0.25) {#1};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (5);
		\draw [bend left, looseness=1.25] (5) to (1.center);
		\draw (1.center) to (4.center);
		\draw [bend right] (5) to (2.center);
		\draw (2.center) to (3.center);
	\end{pgfonlayer}
	\pgfsetbaseline{-0.4ex}
\end{tikzpicture}}


\newcommand{\stringdiagbang}[1]{\begin{tikzpicture}[scale=0.60, transform shape]
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (8) at (2, 0) {};
		\node [style=nodonero] (9) at (3, 0) {};
		\node [style=none] (10) at (2.5, 0.25) {#1};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (8.center) to (9);
	\end{pgfonlayer}
		\pgfsetbaseline{-.4ex}
\end{tikzpicture}}

\newcommand{\stringdiagidentity}[1]{\begin{tikzpicture}[scale=0.60, transform shape]
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (8) at (2, 0) {};
		\node [style=none] (9) at (3, 0) {};
		\node [style=none] (10) at (2.5, 0.25) {#1};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (8.center) to (9);
	\end{pgfonlayer}
		\pgfsetbaseline{-.4ex}
\end{tikzpicture}}
\newcommand{\stringdiagfreccia}[3]{\begin{tikzpicture}[scale=0.60, transform shape]
	\begin{pgfonlayer}{nodelayer}
		\node [style=box] (5) at (1.75, 0) {#2};
		\node [style=none] (7) at (3, 0) {};
		\node [style=none] (8) at (2.5, 0.25) {#3};
		\node [style=none] (9) at (0.5, 0) {};
		\node [style=none] (10) at (1, 0.25) {#1};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (5) to (7);
		\draw (9.center) to (5);
	\end{pgfonlayer}
	\pgfsetbaseline{-.4ex}
\end{tikzpicture}
}
\newcommand{\nodo}{\begin{tikzpicture}[scale=0.60, transform shape]
	\begin{pgfonlayer}{nodelayer}
		\node [style=nodonero] (0) at (0, 0) {};
	\end{pgfonlayer}
	\pgfsetbaseline{-.4ex}
\end{tikzpicture}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\title{Weakly affine monads}
\titlerunning{Weakly affine monads}

\author{Tobias Fritz}{Department of Mathematics, University of Innsbruck, AT}{
ias.fritz@uibk.ac.at}{}{}
\author{Paolo Perrone}{Department of Computer Science, University of Oxford, UK}{paolo.perrone@cs.ox.ac.uk}{https://orcid.org/0000-0002-9123-9089}{}
\author{Fabio Gadducci}{Department of Computer Science, University of Pisa, Pisa, IT}{fabio.gadducci@unipi.it}{https://orcid.org/
0000-0003-0690-3051}{}
\author{ Davide Trotta }{Department of Computer Science, University of Pisa, Pisa, IT}{trottadavide92@gmail.com}{https://orcid.org/0000-0003-4509-594X}{}
\authorrunning{F. Gadducci et alii}
%The research is supported by the MIUR PRIN 2017FTXR "IT-MaTTerS"

\Copyright{Tobias Fritz and Fabio Gadducci and Paolo Perrone and Davide Trotta} 
\ccsdesc[500]{}


\keywords{String diagrams, gs-monoidal and Markov categories, categorical probability, affine monads.} %TODO mandatory; please add comma-separated list of keywords

\begin{document}

\maketitle

\begin{abstract}
   Introduced in the 1990s in works on the algebraic approach to graph rewriting, 
   gs-monoidal categories are symmetric monoidal categories 
   where each object has the structure of a commutative comonoid. They arise for example as 
   Kleisli categories of commutative monads on cartesian categories, 
   and as such provide a useful framework for effectful computation. 
   Recently proposed in the context of categorical probability, Markov categories are
   gs-monoidal categories where the monoidal unit is also terminal, and they arise for example as
   Kleisli categories of commutative \emph{affine} monads, where affine means that the monad is required to preserve the terminal object.

   The aim of this paper is to study a new condition on the gs-monoidal structure, resulting in the concept of \emph{weakly Markov categories}, which are intermediate between general 
   gs-monoidal categories and Markov categories. 
   In a weakly Markov category, the morphisms to the monoidal unit are not necessarily unique, but form a group.
   As we show, these categories exhibit a 
   rich theory of conditional independence for morphisms, generalising the known theory for Markov categories. We also introduce the corresponding 
   notion for commutative monads, which we call weakly affine, and for which we give two equivalent
   characterisations.

   The paper argues that such monads are relevant to the study of categorical probability.
   A case at hand is the monad of non-negative, non-zero measures, which is weakly affine but not affine. 
   With these structures, one can investigate probability without normalisation within a fruitful categorical framework.
\end{abstract}

\section{Introduction}

The idea of \emph{gs-monoidal categories}, monoidal categories equipped with copy and discard morphisms for each object,\footnote{See the next section for the full definition.} was first introduced in the context of algebraic approaches to term graph rewriting~\cite{CorradiniGadducci97}, and then
developed in a series of papers \cite{CorradiniGadducci99, CorradiniGadducci02, CorradiniGadducci99b}.
Two decades later, similar structures have been rediscovered independently in the context of categorical probability theory, in particular in \cite{cho_jacobs_2019} and \cite{Fritz_2020}, under the names of \emph{copy-discard (CD) categories} and \emph{Markov categories}.
While ``CD categories'' and ``gs-monoidal categories'' are synonyms, Markov categories have the additional condition that every morphism commutes with the discard maps, a condition corresponding to normalization of probability. See~\cite[Remark~2.2]{fritz2022} for a more detailed history of these ideas. 

A canonical way of obtaining a gs-monoidal category is as the Kleisli category of a commutative monad on a cartesian monoidal category. 
As argued in \cite{kock2012distributions}, commutative monads can be seen as generalizing theories of \emph{distributions} of some kind, and the fact that their Kleisli categories are gs-monoidal can be seen as the correspondence between distributions and (possibly unnormalized) probability theory.
In particular, when the monad is affine (i.e.~it preserves the monoidal unit \cite{Kock71,Jacobs1994}), the Kleisli category is Markov---this can be seen as the correspondence between normalized distributions and probability theory.

In this work we introduce and study an intermediate notion between gs-monoidal and Markov categories, which we call \emph{weakly Markov categories}. 
These are defined as gs-monoidal categories where morphisms to the monoidal unit form a group (\Cref{defweaklymarkov}). 
Weakly Markov categories can be interpreted intuitively as gs-monoidal categories where each morphism is discardable up to a suitable notion of normalization (see \Cref{weaklydiscardable} for the precise mathematical statement). In particular, every Markov category is weakly Markov.

In parallel to weakly Markov categories we also introduce \emph{weakly affine monads}, monad which map the monoidal unit to a group object (\Cref{defweaklyaffine}).
As a particular concrete example, of relevance in probability and measure theory, we give the monad of finite nonzero measures on $\Set$ (\Cref{ex:nonzero_measures}), which we use as running example in the rest of the work.
As we show, a commutative monad on a cartesian monoidal category is weakly affine if and only if its Kleisli category is weakly Markov, analogously to what happens with affine monads and Markov categories. 

Markov categories come equipped with a notion of \emph{conditional independence}, which has been one of the main motivations for their use in categorical probability and statistics \cite{cho_jacobs_2019,Fritz_2020,fritz2022dseparation}.
A notion of conditional independence can be given for generic gs-monoidal categories. As we show, in the case of weakly Markov categories it has convenient properties which can be considered ``up-to-normalization'' versions of their corresponding Markov-categorical counterpart.
Using these concepts, we give an equivalent condition for weak affinity of a monad, a pullback condition on the associativity diagram (\Cref{mainthm}), widely generalizing the well-known statement that a monoid is a group if and only if its associativity diagram is a pullback (\Cref{assoc_group}). 


\paragraph*{Outline.}
In \Cref{secbackground} we review the main structures used in this work, in particular group and monoid objects, gs-monoidal and Markov categories, and their interaction with commutative monads.

In \Cref{secweakly} we define the main original concepts, namely weakly Markov categories and weakly affine monads. We study their relationship, and prove that a commutative monad on a cartesian category is weakly affine if and only if its Kleisli category is weakly Markov (\Cref{weaklyboth}).
We then turn to concrete examples using measures and group actions (\Cref{secexamples}).

In \Cref{secindep} we extend the concept of conditional independence from Markov categories to general gs-monoidal categories, and specialize to the weakly Markov case, showing that in the latter case, the situation is similar to what happens in Markov categories, but only up to normalization, in a way that we make mathematically precise.
We use this formalism to equivalently reformulate affinity in terms of a pullback condition (\Cref{mainthm}). This can be considered the main result of this work.

Finally, in \Cref{secfurther}, we pose further questions, such as when we can iterate the construction of weakly Markov categories by means of weakly affine monads, and the relationship with strongly affine monads in the sense of Jacobs~\cite{Jacobs16}.


\section{Background}
\label{secbackground}

In this section, we develop some relevant background material for later reference.
To begin, the following categorical characterization of groups will be useful to keep in mind.
\begin{myproposition}\label{assoc_group}
 A monoid $(M,m,e)$ in $\Set$ is a group if and only if the associativity square
 \begin{equation}\label{assoc}
  \begin{tikzcd}
   M \times M \times M \ar{d}{\id\times m} \ar{r}{m\times\id} & M\times M \ar{d}{m} \\
   M\times M \ar{r}{m} & M
  \end{tikzcd}
 \end{equation}
 is a pullback.
\end{myproposition}
\begin{proof}
 The square~\eqref{assoc} is a pullback of sets if and only if given $a,g,h,c\in M$ such that $ag=hc$, there exists a unique $b\in M$ such that $g=bc$ and $h=ab$.
 First, suppose that $G$ is a group. Then the only possible choice of $b$ is 
 \[
  b = a^{-1}h = gc^{-1},
 \]
 which is unique by uniqueness of inverses. 
 
 Conversely, suppose that \eqref{assoc} is a pullback. We can set $g,h=e$ and $c=a$ so that $ae=ea=a$. 
 Instantiating the pullback property on these elements gives $b$ such that $ab=e$ and $ba=e$, that is, $b=a^{-1}$.
\end{proof}

\Cref{assoc_group} holds generally for a monoid object in a cartesian monoidal category, where the elementwise proof still applies thanks to the following standard observation.

\begin{myremark}
\label{yonedaremark}
	Given an object $M$ in a cartesian monoidal category $\mD$, there is a bijection between internal monoid structures on $M$ and monoid structures on every hom-set $\mD(X, M)$ such that precomposition with any $f : X \to Y$ defines a monoid homomorphism
	\[
		\mD(Y, M) \longrightarrow \mD(X, M).
	\]
	The proof is straightforward by the Yoneda lemma.
	It follows that \Cref{assoc_group} holds for internal monoids in cartesian monoidal categories in general.
\end{myremark}

For the consideration of categorical probability, we now recall the simplest version of a commutative monad of measures.
This works with measures taking values in any semiring instead of $[0,\infty)$ (see e.g.~\cite[Section~5.1]{coumans2013scalars}), but we restrict to the concrete case of $[0,\infty)$ for simplicity.

\begin{mydefinition}\label{monadM}
 Let $X$ be a set. Denote by $MX$ the set of \emph{finitely supported measures on $X$}, i.e.~functions $m:X\to[0,\infty)$ which are zero for all but a finite number of $x\in X$. 
 Given a function $f:X\to Y$, denote by $Mf:MX\to MY$ the function sending $m\in MX$ to the assignment
 \[
	 (Mf)(m) \: : \: y \longmapsto \sum_{x\in f^{-1(y)}} p(x) .
 \]
 This makes $M$ into a functor, and even a monad with the unit and multiplication maps
 \[
  \begin{tikzcd}[row sep=0]
   X \ar{r}{\delta} & MX \\
   x \ar[mapsto]{r} & \delta_x ,
  \end{tikzcd}
  \qquad\qquad
  \begin{tikzcd}[row sep=0]
   MMX \ar{r}{E} & MX \\
   \xi \ar[mapsto]{r} & E\xi ,
  \end{tikzcd}
 \]
 where 
 \[
  \delta_x(x') = \begin{cases}
                  1 & x=x' , \\
                  0 & x\ne x',
                 \end{cases}
 \qquad\qquad
 (E\xi)(x) = \sum_{m\in MX} \xi(m)\,m(x) .
 \]
 Call $M$ the \emph{measure monad} on $\Set$.

 Denote also by $DX\subseteq MX$ the subset of \emph{probability measures}, i.e.~those finitely supported $p:X\to[0,\infty)$ such that
 \[
  \sum_{x\in X} p(x) = 1 .
 \]
 $D$ forms a submonad of $M$ called the \emph{distribution monad}.
\end{mydefinition}

It is well-known that $M$ is even a commutative monad~\cite{coumans2013scalars}.
The corresponding lax monoidal structure
\[
	MX \times MY \stackrel{c}{\longrightarrow} M(X \times Y)
\]
is exactly the formation of product measures given by $c(m, m')(x, y) = m(x) m'(y)$.
Also $D$ is a commutative monad with the same lax monoidal structure, since the product of probability measures is again a probability measure.

\subsection{GS-monoidal and Markov categories}


We recall here the basic definitions adopting the graphical formalism of string diagrams,
referring to \cite{Selinger2011} for background on various notions of monoidal categories and their associated diagrammatic calculus.


\begin{mydefinition}
A \textbf{gs-monoidal category} is a symmetric monoidal category $(\mC, \otimes, I)$
with a commutative comonoid structure on each object $X$ consisting of a comultiplication
and a counit,
\ctikzfig{copy_del}
which satisfy the commutative comonoid equations:
\ctikzfig{comonoid_equation}
These comonoid structures must be multiplicative with respect to the monoidal structure:
\ctikzfig{comon-struct-mult}

\end{mydefinition}


\begin{mydefinition}
 A morphism $f:X\to Y$ in a gs-monoidal category is called \textbf{copyable} or \textbf{functional} if and only if
 \ctikzfig{functional}
 It is called \textbf{discardable} or \textbf{full} if 
 \ctikzfig{full}
\end{mydefinition}

\begin{myexample}
The category $\Rel$ of sets and relations with the monoidal operation $\otimes : \Rel \times \Rel\to \Rel$ given by the direct product of sets is a gs-monoidal category \cite{CorradiniGadducci02}. In this gs-monoidal category, the copyable arrows are precisely the partial functions, and the discardable arrows are the total relations.
\end{myexample}

\begin{myremark}
It is well-known that if every morphism is copyable and discardable, or equivalently if the copy and discard maps are natural, then the monoidal product is the categorical product, and thus the category is cartesian monoidal \cite{Fox:CACC}.
More concisely, the following conditions are equivalent for a gs-monoidal category $\mC$:
 \begin{itemize}
  \item $\mC$ is cartesian monoidal;
  \item every morphism is copyable and discardable;
  \item the copy and discard maps are natural.
 \end{itemize}
\end{myremark}

In recent works \cite{tba}
\todo{add ref}
it has been shown that gs-monoidal categories naturally arise in several ways, such as Kleisli categories of commutative monads or span categories. In the following proposition, we recall the result regarding Kleisli categories:

\begin{myproposition}\label{monoidalgs}
 Let $T$ be a commutative monad on a cartesian monoidal category $\mD$. 
 Then its Kleisli category $\mathrm{Kl}_T$ is canonically a gs-monoidal category with copy and discard structure induced by that of $\mD$.
\end{myproposition}

\begin{myexample}\label{kleisliM}
 The Kleisli categories of the monads $M$ and $D$ of \Cref{monadM} are gs-monoidal. We can write their Kleisli categories concretely as follows:
 \begin{itemize}
  \item A morphism $k:X\to Y$ of $\mathrm{Kl}(M)$ is a \emph{matrix} with rows indexed by $Y$ and columns indexed by $X$, and non-negative entries $k(y|x)$ such that for each $x\in X$, the number $k(y|x)$ is nonzero only for finitely many $x$;
  \item A morphism $k:X\to Y$ of $\mathrm{Kl}(D)$ is a morphism of $\mathrm{Kl}(M)$ such that moreover, for all $x\in X$, the sum of each column
  \[
   \sum_{y\in Y} k(y|x) = \sum_{y\in Y|k(y|x)\ne 0} k(y|x)
  \]
  is equal to $1$. If $X$ and $Y$ are finite, such a matrix is called a \emph{stochastic matrix}.
 \end{itemize}
 In both categories, identities are identity matrices, and composition is matrix composition. 
\end{myexample}

Nowadays, \emph{Markov categories}~\cite{Fritz_2020} represent one of the more interesting specializations of the notion of gs-monoidal category. Based on the interpretation of their arrows
 as generalised Markov kernels, Markov categories are considered the foundation for a categorical approach to probability theory.

\begin{mydefinition}
 A gs-monoidal category is said to be a \textbf{Markov category} if any (hence all) of the following equivalent conditions are satisfied:
 \begin{itemize}
  \item the monoidal unit is terminal;
  \item the discard maps are natural;
  \item every morphism is discardable.
 \end{itemize}
\end{mydefinition}

We recall from \cite{Kock71,Jacobs1994} the notion of \emph{affine monad}:

\begin{mydefinition}
 A monad $T$ on a cartesian monoidal category is called \textbf{affine} if $T1\cong 1$.
\end{mydefinition}

It was observed in~\cite[Corollary~3.2]{Fritz_2020} that if the monad preserves the terminal object, then every arrow of the Kleisli category is discardable, and this makes the Kleisli category into a Markov category.
In other words, we have the following specialization of \Cref{monoidalgs}:

\begin{myproposition}\label{affinemarkov}
Let $T$ be a symmetric monoidal (equivalently, commutative) monad on a cartesian monoidal category $\mD$. Then $\mathrm{Kl}_T$ is Markov if and only if $T$ is affine.
\end{myproposition}
 
 
\begin{myexample}
 The distribution monad $D$ of \Cref{monadM} is affine, and so its Kleisli category (\Cref{kleisliM}) is a Markov category. It is one of the simplest examples of categories of relevance for categorical probability.
 
 The measure monad $M$ is not affine, as $M1\cong[0,\infty)$, and so its Kleisli category is not Markov.
\end{myexample}


\section{Weakly Markov categories and weakly affine monads}
\label{secweakly}

In this section, we introduce an intermediate level between gs-monoidal and Markov called \emph{weakly Markov}, and its corresponding notion for monads, which we call \emph{weakly affine}.

\subsection{The monoid of effects}\label{monoids}

In a gs-monoidal category $\mC$ we call a \emph{state} a morphism from the monoidal unit $p:I\to X$, and \emph{effect} a morphism to the monoidal unit $a:X\to I$.
As is standard convention, we represent such morphisms as triangles as follows.
 \ctikzfig{state-costate}

 Effects, i.e.~elements of the set $\mC(X,I)$, form canonically a commutative monoid as follows: the monoidal unit is the discard map $X\to I$, and given $a,b:X\to I$, their product $ab$ is given by copying:\footnote{See also e.g.~the $\odot$ product in~\cite[Proposition~3.10]{coecke2011phasegroups}.}
\ctikzfig{ptwise-product}
If a morphism $f:X\to Y$ is copyable and discardable, precomposition with $f$ induces a morphism of monoids $\mC(Y,I)\to\mC(X,I)$. 

\begin{myremark}
 The monoidal unit $I$ of a monoidal category is canonically a monoid object via the coherence isomorphisms $I\otimes I\cong I$ and $I\cong I$. 
 However, in a generic (non-cartesian) gs-monoidal category $\mC$, the monoid structure on $\mC(X,I)$ is not the one given as in \Cref{yonedaremark} by considering the presheaf represented by the monoid object $I$. In order for \Cref{yonedaremark} to hold, we would need that every precomposition is a morphism of monoids. As remarked above, this fails in general if not all morphisms are copyable and discardable (i.e.~if $\mC$ is not cartesian monoidal).
\end{myremark}


Let's now consider the case where the gs-monoidal structure comes from a commutative monad on a cartesian monoidal category $\mD$. 
In this case, the monoid structure on Kleisli morphisms $X\to 1$ does come from the canonical internal monoid structure on $T1$ (and from the one on $1$) in $\mD$.
Indeed, $T1$ is a monoid object with the following unit and multiplication~\cite[Section~10]{kock2012distributions},
 \[
 \begin{tikzcd}
  1 \ar{r}{\eta} & T1 ,
 \end{tikzcd}
 \qquad
 \begin{tikzcd}
  T1 \times T1 \ar{r}{c} & T(1\times 1) \ar{r}{\cong} & T1 .
 \end{tikzcd}
 \]
 For example, for the monad of measures $M$, we obtain $M1=[0,\infty)$ with its usual multiplication.
 The resulting monoid structure on Kleisli morphisms $X\to 1$ is now given as follows. The unit is given by
 \[
 \begin{tikzcd}
  X \ar{r}{!} & 1 \ar{r}{\eta} & T1 ,
 \end{tikzcd}
 \]
 and the multiplication of Kleisli morphisms $f, g : X \to 1$ represented by $f^\sharp,g^\sharp:X\to T1$ is the Kleisli morphism represented by
 \[
 \begin{tikzcd}
  X \ar{r}{\mathrm{copy}_X} & X\times X \ar{r}{f^\sharp\times g^\sharp} &
  T1 \times T1 \ar{r}{c} & T(1\times 1) \ar{r}{\cong} & T1 .
 \end{tikzcd}
 \]
 For the monad of measures $M$, Kleisli morphisms $X\to 1$ are functions $X\to [0,\infty)$, and this description shows that their product is the pointwise product.

For general $\mC$, note that the commutative monoid $\mC(X,I)$ acts on the set $\mC(X,Y)$: given $a:X\to I$ and $f:X\to Y$, the resulting $a\cdot f$ is given as follows,
\ctikzfig{action}
It is straightforward to see that this indeed amounts to an action of the monoid $\mC(X,I)$ on the set $\mC(X,Y)$.
For the monad of measures $M$, this action is given by pointwise rescaling.

Moreover, for general $\mC$ the operation
\begin{align*}
	\mC(X,Y) \times \mC(X,Z) & \longrightarrow \mC(X,Y \otimes Z)		\\
	(f,g) & \longmapsto f\cdot g \coloneqq (f\otimes g)\circ\mathrm{copy}_X
\end{align*}
commutes with this action in each variable (separately). 

\subsection{Main definitions}


\begin{mydefinition}\label{defweaklymarkov}
 A gs-monoidal category $\mC$ is called \textbf{weakly Markov} if for every object $X$, the monoid $\mC(X,I)$ is a group. 
\end{mydefinition}

Every Markov category is weakly Markov: for each $X$, the monoid $\mC(X,I)$ is the trivial group.

\begin{mydefinition}
 Given two parallel morphisms $f,g:X\to Y$ in a weakly Markov category $\mC$, we say that $f$ and $g$ are called \textbf{equivalent}, denoted $f\sim g$, if they lie in the same orbit for the action of $\mC(X,I)$, i.e.~if there is $a\in \mC(X,I)$ such that $a\cdot f=g$.
\end{mydefinition}

Note that if $a\cdot f=g$ for some $a$, then $a$ is unique. This can be seen by marginalizing over $Y$ the following diagram.
\ctikzfig{free-action}
In other words, the action of $\mC(X,I)$ on $\mC(X,Y)$ is free, i.e.~it has trivial stabilizers.

For the next statement, let's first call the \emph{mass} of a morphism $f:X\to Y$ in a gs-monoidal category $\mC$ the morphism $m_f\coloneqq \mathrm{del}\circ f:X\to I$.
Note that $f$ is discardable if and only if $m_f=\mathrm{del}$, i.e.~if its mass is the unit of the monoid $\mC(X,I)$.

\begin{myproposition}\label{weaklydiscardable}
 Every morphism $f:X\to Y$ in a weakly Markov category is equivalent to a unique discardable morphism.
\end{myproposition}
We call the discardable morphism the \emph{normalization} of $f$ and denote it by $n_f:X\to Y$.
\begin{proof}
 Consider the mass $m_f$, and denote its group inverse by $m_f^{-1}$. The morphism $n_f\coloneqq m_f^{-1}\cdot f$ is discardable and equivalent to $f$.
 Suppose now that $d:X\to Y$ is discardable and equivalent to $f$, i.e.~there exists $a:X\to I$ such that $d = a\cdot f$. 
 Since $d$ is discardable,
 \ctikzfig{normalization_proof}
 which means that $a=m_f^{-1}$, i.e.~$d=n_f$. 
\end{proof}
In other words, every morphism $f$ can be written as its mass times its normalization. 

Let's now look at the Kleisli case.

\begin{mydefinition}\label{defweaklyaffine}
 A commutative monad $T$ on a cartesian monoidal category is called \textbf{weakly affine} if $T1$ with its canonical internal commutative monoid structure is a group.
\end{mydefinition}

This choice of terminology is motivated by the following proposition, which can be seen as a ``weakly'' version of \Cref{affinemarkov}.

\begin{myproposition}\label{weaklyboth}
 Let $\mD$ be a cartesian monoidal category, and let $T$ be a commutative monad on $\mD$. Then the Kleisli category of $T$ is weakly Markov if and only if $T$ is weakly affine.
\end{myproposition}
\begin{proof}
 First, suppose that $T1$ is an internal group, and denote by $\iota:T1\to T1$ its inversion map. 
 The inverse of a Kleisli morphism $a : X \to 1$ in $\mathrm{Kl}_T(X,1)$ represented by $a^\sharp:X\to T1$ is represented by $\iota\circ a^\sharp$: indeed, the following diagram in $\mD$ commutes,
 \[
  \begin{tikzcd}
  X \ar[bend right=5pc]{dd}[swap]{!} \ar{d}[swap]{a^\sharp} \ar{r}{\mathrm{copy}_X} & X\times X \ar{d}[swap]{a^\sharp\times a^\sharp} \ar{dr}{a^\sharp\times(\iota\circ a^\sharp)} \\
  T1 \ar{d}[swap]{!} \ar{r}[swap]{\mathrm{copy}_{T1}} & T1\times T1 \ar{r}[swap]{\id\times\iota} & T1\times T1 \ar{r}{c} & T(1\times 1) \ar{d}{\cong} \\
  1 \ar{rrr}{\eta} &&& T1
  \end{tikzcd}
 \]
 where the bottom rectangle commutes since $\iota$ is the inversion map for $T1$. The analogous diagram with $\iota\times\id$ in place of $\id\times\iota$ commutes analogously.
 
 Conversely, suppose that for every $X$, the monoid structure on $\mathrm{Kl}_T(X,1)$ has inverses. Then in particular we can take $X=T1$, and the inverse of the Kleisli morphism $\id:T1\to T1$ is an inversion map for $T1$. 
\end{proof}

This result can also be thought of in terms of the Yoneda embedding, via \Cref{yonedaremark}: since the Yoneda embedding preserves and reflects pullbacks (and all limits), the associativity square for $T1$ is a pullback in $\mD$ if and only if the associativity squares of all the monoids $\mD(X,T1)$ are pullbacks.
Note that \Cref{yonedaremark} holds since we are assuming that $\mD$ is \emph{cartesian} monoidal. In the proof of \Cref{weaklyboth}, this is reflected by the fact in the main diagram, the morphism $a^\sharp$ commutes with the copy maps. 


\subsection{Examples of weakly affine monads} 
\label{secexamples}

Every affine monad is a weakly affine monad. Here are less trivial examples.

\begin{myexample}
    \label{ex:nonzero_measures}
	Let $M^* : \Set \to \Set$ be the monad assigning to every set the set of finitely supported discrete \emph{nonzero}
	measures on $M^*$, or equivalently let $M^*(X)$ for any set $X$ be the set of nonzero finitely supported functions $X \to [0,\infty)$.
	It is a submonad $M^* \subseteq M$, meaning that the monad structure is defined in terms of the same formulas as for the monad of measures $M$ (\Cref{monadM}).
	Similarly, the lax structure components $c_{X,Y}$ are also given by the formation of product measures, or equivalently pointwise products of functions 
	$X \to [0,\infty)$.

	Since $M^* 1 \cong (0,\infty)\ncong 1$, this monad is not affine. However the monoid structure of $(0,\infty)$ induced by $M^*$ is the usual multiplication of positive real numbers, which form a group. Therefore $M^*$ is weakly affine, and its Kleisli category is weakly Markov.

	\todo[inline]{T: More generally, we could consider nonzero measures with values in any positive semifield, see the corresponding monads considered in \href{https://arxiv.org/abs/2108.10718}{arXiv:2108.10718}. Not sure though if it's interesting enough to mention?}

	On the other hand, if the zero measure is included, we have $M1 \cong [0,\infty)$ which is not a group under multiplication, so $M$ is not weakly affine.
\end{myexample}

\begin{myexample}
	\label{ex:abelian_group}
	Let $A$ be a commutative monoid.
	Then the functor $T_A \coloneqq A \times -$ on $\Set$ has a canonical structure of commutative monad, 
	where the lax structure components $c_{X,Y}$ are given by multiplying elements in $A$ while carrying the elements 
	of $X$ and $Y$ along.

	Since $T_A(1) \cong A$, the monad $T_A$ is weakly affine if and only if $A$ is a group, and affine if and only if $A\cong 1$.
\end{myexample}

\begin{myexample}
    \label{ex:nonexample}
    Here is a negative example.
    Consider the free abelian group monad $F$ on $\Set$. Its functor takes a set $X$ and forms the set $FX$ of finite multisets (with repetition, where order does not matter) of elements of $X$ and their formal inverses. 
    We have that $F1\cong \mathbb{Z}$, which is an abelian group under addition. 
    However, the monoid structure on $F1$ induced by the monoidal structure of the monad corresponds to the \emph{multiplication} on $\mathbb{Z}$, which does not have inverses. Therefore $F$ is not weakly affine. 
\end{myexample}


\section{Conditional independence in weakly Markov categories}
\label{secindep}

Markov categories have a rich theory of conditional independence in the sense of probability theory~\cite{fritz2022dseparation}. 
Some of those ideas can be translated and generalized to the setting of weakly Markov categories. 

\begin{mydefinition}\label{defcondind}
 A morphism $f:A\to X_1\otimes\dots\otimes X_n$ in a gs-monoidal category $\mC$ is said to exhibit \textbf{conditional independence of the $X_i$ given $A$} if and only if it can be expressed as a product of the following form.
 \ctikzfig{cond-ind-sep}
\end{mydefinition}

Note that this formulation is a bit different from the earlier definitions given in \cite[Definition~6.6]{cho_jacobs_2019} and~\cite[Definition~12.12]{Fritz_2020}, which were formulated for morphisms in Markov categories and state that $f$ exhibits conditional independence if the above holds with the $g_i$ being the \emph{marginals} of $f$, which are
\ctikzfig{marginal}
Indeed in a Markov category, conditional independence in our sense holds if and only if it holds with $g_i = f_i$~\cite[Lemma~12.11]{Fritz_2020}.
We also say that $f$ is the \emph{product of its marginals}.

\begin{myexample}
 In the Kleisli category of the distribution monad $D$, which is Markov, a morphism $f:A\to X\otimes Y$ exhibits conditional independence if and only if its value at every $a \in A$ is the product of its marginals~\cite[Section~12]{Fritz_2020}.
\end{myexample}

Here is what conditional independence looks like in the Kleisli case.

\begin{myproposition}\label{indepkleisli}
 Let $\mD$ be a cartesian monoidal category, and let $T$ be a commutative monad on $\mD$.
 A Kleisli morphism represented by $f^\sharp:A\to T(X_1\times\dots\times X_n)$ exhibits conditional independence of the $X_i$ given $A$ if and only if it factors as follows
 \[
 \begin{tikzcd}
  A \ar{d}[swap]{(g_1^\sharp,\dots,g_n^\sharp)} \ar{dr}{f^\sharp} \\
  TX_1\times\dots\times TX_n \ar{r}[swap]{c} & T(X_1\times\dots\times X_n) ,
 \end{tikzcd}
 \]
 for some Kleisli maps $g_i^\sharp:A\to TX_i$,
 where the map $c$ above is the one obtained by iterating the lax monoidal structure (which is unique by associativity). 
\end{myproposition}
\begin{proof}
 In terms of the base category $\mD$, a Kleisli morphism in the form of \Cref{defcondind} reads as follows.
 \[
  \begin{tikzcd}[sep=large]
   A \ar{r}{\mathrm{copy}} & A\times\dots\times A \ar{r}{g_1^\sharp\times\dots\times g_n^\sharp} & TX_1\times\dots\times TX_n \ar{r}{c} & T(X_1\times\dots\times X_n) .
  \end{tikzcd}
 \]
 Therefore $f^\sharp:A\to T(X_1\times\dots\times X_n)$ exhibits the conditional independence if and only if it is of the form above.
\end{proof}

\begin{myexample}\label{zeromeasure}
	In the Kleisli category of the measure monad $M$, and for any objects, the morphism $A \to X_1 \otimes \cdots \otimes X_n$ given by the zero measure on every $a \in A$ exhibits conditional independence of its outputs given its input. For example, for $A=1$, the zero measure on $X\times Y$ is the product of the zero measure on $X$ and the zero (or any other) measure on $Y$.
 Notice that both marginals of the zero measure are zero measures---therefore, the factors appearing in the product are not necessarily related to the marginals.
\end{myexample}

In a weakly Markov category, the situation is similar to the Markov case discussed above,
but up to equivalence: an arrow exhibits conditional independence if and only if it is \emph{equivalent to} the product of all its marginals.

\begin{myproposition}\label{eqcondind}
 Let $f:A\to X_1\otimes\dots\otimes X_n$ be a morphism in a weakly Markov category $\mC$. Then $f$ exhibits conditional independence of the $X_i$ given $A$ if and only if it is equivalent to the product of all its marginals.
\end{myproposition}

\begin{proof}
 Denote the marginals of $f$ by $f_1,\dots,f_n$.
 Suppose that $f$ is a product as in \Cref{defcondind}. For each $i=1,\dots,n$, by marginalizing, we get that $f_i$ is equal to the following.
  \ctikzfig{cond-ind-proof} 
 Therefore for each $i$ we have that $f_i\sim g_i$. 
 
 Conversely, suppose that $f$ is equivalent to the product of its marginals, i.e.~that there exists $a:X\to I$ such that $f$ is equal to the following.
 \ctikzfig{cond-ind-proof2}
 One can then choose $g_i=f_i$ for all $i<n$, and $g_n = a\cdot f_n$, so that $f$ is in the form of \Cref{defcondind}.
\end{proof} 
 
\begin{myremark}
 For $n=2$, a morphism $f:A\to X\otimes Y$ in a weakly Markov category $\mC$ exhibits conditional independence of $X$ and $Y$ given $A$ 
 if and only if the following equation holds.
 \ctikzfig{cond-ind2} 
\end{myremark}


\subsection{Main result}

The concept of conditional independence for general weakly Markov categories allows us to give an equivalent characterization of weakly affine monads.
The condition is in terms of a pullback condition on the associativity diagram, and can be seen as a generalization of \Cref{assoc_group}.

\begin{mytheorem}\label{mainthm}
 Let $\mD$ be a cartesian monoidal category, and let $T$ be a commutative monad on $\mD$.
 Then the following conditions are equivalent.
 \begin{enumerate}
  \item\label{condgroup} $T$ is weakly affine;
  \item\label{condwm} The Kleisli category $\mathrm{Kl}_T$ is weakly Markov;
  \item\label{condpullback} For all objects $X$, $Y$, and $Z$, the following associativity diagram is a pullback.
	\begin{equation}
		\label{assoc_pullback}
		\hspace{-9pt}	% T: for centering the equation number
		\begin{tikzcd}[column sep=3.3pc]
			T(X) \times T(Y) \times T(Z) \ar{r}{\id \times c_{Y,Z}} \ar[swap]{d}{c_{X,Y} \times \id}	& T(X) \times T(Y \times Z) \ar{d}{c_{X,Y \times Z}}	\\
			T(X \times Y) \times T(Z) \ar{r}{c_{X\times Y,Z}}						& T(X \times Y \times Z)
		\end{tikzcd}
	\end{equation}
 \end{enumerate}
\end{mytheorem}

We prove the theorem by means of the following property of weakly Markov categories.

\begin{mylemma}[localized independence property]\label{local}
 Let $\mC$ be a weakly Markov category. Whenever a morphism  $f:A\to X\otimes Y\otimes Z$ exhibits conditional independence of $X\otimes Y$ (jointly) and $Z$ given $A$, as well as conditional independence of $X$ and $Y\otimes Z$ given $A$, then it exhibits conditional independence of $X$, $Y$ and $Z$ given $A$. 
\end{mylemma}
\begin{proof}[Proof of \Cref{local}]
 Suppose $f:A\to X\otimes Y\otimes Z$ exhibits conditional independence of $X\otimes Y$ (jointly) and $Z$ given $A$, as well as conditional independence of $X$ and $Y\otimes Z$ given $A$.
 By marginalizing out $X$, we have that $f_{YZ}$ exhibits conditional independence of $Y$ and $Z$ given $A$. 
 Since by hypothesis $f$ exhibits conditional independence of $X$ and $Y\otimes Z$ given $A$, by \Cref{eqcondind} we have that $f$ is equivalent to the product  of $f_X$ and $f_{YZ}$. But, again by \Cref{eqcondind}, $f_{YZ}$ is equivalent to the product of $f_Y$ and $f_Z$, so we have that $f$ is equivalent to the product of all its marginals. Using \Cref{eqcondind} in the other direction, this means that $f$ exhibits conditional independence of $X$, $Y$ and $Z$ given $A$. 
\end{proof}
 
We are now ready to prove the theorem.

\begin{proof}[Proof of \Cref{mainthm}]
 $\ref{condgroup}\Leftrightarrow\ref{condwm}$: 
 see \Cref{weaklyboth}.
 
 $\ref{condgroup}\Rightarrow\ref{condpullback}$: 
 By the universal property of products, a cone over the cospan in \eqref{assoc_pullback} consists of maps $g_1^\sharp:A\to TX$, $g_{23}^\sharp:A\to T(Y\times Z)$, $g_{12}^\sharp:A\to T(X\times Y)$ and $g_3^\sharp:A\to TZ$ such that the following diagram commutes. 
 \[
  \begin{tikzcd}[column sep=3.3pc]
   A \ar[bend left=10]{drr}{(g_1^\sharp,g_{23}^\sharp)} \ar[bend right=15]{ddr}[swap]{(g_{12}^\sharp,g_3^\sharp)} \\
   & T(X) \times T(Y) \times T(Z) \ar{r}[swap]{\id \times c_{Y,Z}} \ar{d}{c_{X,Y} \times \id}	& T(X) \times T(Y \times Z) \ar{d}{c_{X,Y \times Z}}	\\
   & T(X \times Y) \times T(Z) \ar{r}[swap]{c_{X\times Y,Z}}						& T(X \times Y \times Z)
  \end{tikzcd}
 \]
 By \Cref{indepkleisli}, this amounts to a Kleisli map $f^\sharp:A\to T(X\times Y\times Z)$ exhibiting conditional independence of $X$ and $Y\otimes Z$ given $A$, as well as of $X\otimes Y$ and $Z$ given $A$. By the localized independence property (\Cref{local}), we then have that $f$ exhibits conditional independence of all $X$, $Y$ and $Z$ given $A$, and so, again by \Cref{indepkleisli}, $f^\sharp$ factors through the product $TX\times TY\times TZ$. 
 More specifically, by marginalizing over $Z$, we have that $g_{12}^\sharp$ factors through $TX\times TY$, i.e.~the following diagram on the left commutes for some $h_1^\sharp:A\to TX$ and $h_2^\sharp:A\to TY$, and similarly, by marginalizing over $X$, the diagram on the right commutes for some $\ell_2^\sharp:A\to TY$ and $\ell_3^\sharp:A\to TZ$.
 \[
  \begin{tikzcd}
   A \ar{d}[swap]{(h_1^\sharp,h_2^\sharp)} \ar{dr}{g_{12}^\sharp} \\
   TX\times TY \ar{r}[swap]{c} & T(X\times Y) 
  \end{tikzcd}
  \qquad
  \begin{tikzcd}
   A \ar{d}[swap]{(\ell_2^\sharp,\ell_3^\sharp)} \ar{dr}{g_{23}^\sharp} \\
   TY\times TZ \ar{r}[swap]{c} & T(Y\times Z) 
  \end{tikzcd}
 \]
 In other words, the upper and the left curved triangles in the following diagram commute.
\[
  \begin{tikzcd}[column sep=3.3pc]
   A \ar[bend left=15, shift left]{drr}{(g_1^\sharp,g_{23}^\sharp)} \ar[bend right=35]{ddr}[swap]{(g_{12}^\sharp,g_3^\sharp)} 
    \ar[shift left]{dr}[near end]{(g_1^\sharp,\ell_2^\sharp,\ell_3^\sharp)} \ar[shift right]{dr}[swap, pos=0.7]{(h_1^\sharp,h_2^\sharp, g_3^\sharp)} \\
   & T(X) \times T(Y) \times T(Z) \ar{r}[swap]{\id \times c_{Y,Z}} \ar{d}{c_{X,Y} \times \id}	& T(X) \times T(Y \times Z) \ar{d}{c_{X,Y \times Z}}	\\
   & T(X \times Y) \times T(Z) \ar{r}[swap]{c_{X\times Y,Z}}						& T(X \times Y \times Z)
  \end{tikzcd}
 \]
 By marginalizing over $Y$ and $Z$, and by weak affinity of $T$, there exists a unique $a^\sharp:A\to T1$ such that $h_1 = a\cdot g_1$. 
 Therefore
 \[
  g_{12} = h_1\cdot h_2 = (a\cdot g_1) \cdot h_2 = g_1\cdot (a\cdot h_2) ,
 \]
 and so in the diagram above we can equivalently replace $h_1$ and $h_2$ with $g_1$ and $a\cdot h_2$.
 Similarly by marginalizing over $X$ and $Y$, there exists a unique $c^\sharp:A\to T1$ such that $\ell_3=c\cdot g_3$, so that
 \[
  g_{23}= \ell_2\cdot\ell_3 = \ell_2\cdot (c\cdot g_3) = (c\cdot \ell_2) \cdot g_3
 \]
 and in the diagram above we can replace $\ell_2$ and $\ell_3$ with $c\cdot \ell_2$ and $g_3$, as follows.
 \[
  \begin{tikzcd}[column sep=3.3pc]
   A \ar[bend left=15, shift left]{drrr}{(g_1^\sharp,g_{23}^\sharp)} \ar[bend right=35]{ddrr}[swap]{(g_{12}^\sharp,g_3^\sharp)} 
    \ar[shift left]{drr}[near end]{(g_1^\sharp,(c\cdot\ell_2)^\sharp,g_3^\sharp)} \ar[shift right]{drr}[swap, pos=0.8]{(g_1^\sharp,(a\cdot h_2)^\sharp, g_3^\sharp)} \\
   && T(X) \times T(Y) \times T(Z) \ar{r}[swap]{\id \times c_{Y,Z}} \ar{d}{c_{X,Y} \times \id}	& T(X) \times T(Y \times Z) \ar{d}{c_{X,Y \times Z}}	\\
   && T(X \times Y) \times T(Z) \ar{r}[swap]{c_{X\times Y,Z}}						& T(X \times Y \times Z)
  \end{tikzcd}
 \]
 Now, marginalizing over $X$ and $Z$, we see that necessarily $a\cdot h_2=c\cdot \ell_2$. 
 Therefore there is a unique map $A\to TX\times TY\times TZ$ making the whole diagram commute, which means that \eqref{assoc_pullback} is a pullback.
 
 $\ref{condpullback}\Rightarrow\ref{condgroup}$:
 If $T$ is weakly affine, then taking $X = Y = Z = 1$ in~\eqref{assoc_pullback} shows that this monoid must be an abelian group: we obtain a unique arrow $\freccia{T(1)}{\iota}{T(1)}$ making the following diagram commute,
	\[
		\begin{tikzcd}
			T1 \ar{dr}[description]{(\id,\iota,\id)} \ar[bend left=15]{drr}{(\id,\eta_1 !)} \ar[bend right,swap]{ddr}{(\eta_1 !,\id)} \\
			&	T1 \times T1 \times T1 \ar{r}{\id \times c_{1,1}} \ar[swap]{d}{c_{1,1} \times \id}	& T1 \times T(1\times 1) \ar{d}{c_{1,1\times 1}} \ar{r}{\cong} & T1\times T1 \ar{d}{c_{1,1}}	\\
			&	T(1\times 1) \times T1 \ar{r}{c_{1\times 1,1}} \ar{d}[swap]{\cong}	& T(1\times 1\times 1) \ar{d}{\cong} \ar{r}{\cong} & T(1\times 1) \ar{d}{\cong} \\
			& T1\times T1 \ar{r}[swap]{c_{1,1}} & T(1\times 1) \ar{r}[swap]{\cong} & T1
		\end{tikzcd}
	\]
	and the commutativity shows that $\iota$ satisfies the equations making it the inversion map for a group structure.
\end{proof}


\begin{myexample}
 In the Kleisli category of the measure monad $\mathrm{Kl}_M$ (which is not weakly affine) consider the following diagram.
 \[
		\hspace{-9pt}	% T: for centering the equation number
		\begin{tikzcd}[column sep=3.3pc]
			MX \times MY \times MZ \ar{r}{\id \times c_{Y,Z}} \ar[swap]{d}{c_{X,Y} \times \id}	& MX \times M(Y \times Z) \ar{d}{c_{X,Y \times Z}}	\\
			M(X \times Y) \times MZ \ar{r}{c_{X\times Y,Z}}						& M(X \times Y \times Z)
		\end{tikzcd}
	\]
	In the top-right corner $MX\times M(Y\times Z)$, take the pair $(0,p)$ where $p$ is any nonzero measure on $Y\times Z$, and similarly, in the bottom-left corner take the pair $(q,0)$ where $q$ is any nonzero measure on $X\times Y$. Following the diagram, both pairs are mapped to the zero measure in the bottom-right corner. If the diagram was a pullback, we would be able to express the top-right and bottom-left corners as coming from the same triple in $MX\times MY\times MZ$, that is, there would exist a measure $m$ on $Y$ such that $m\cdot 0=p$ and $0\cdot m=q$. Since $p$ and $q$ are nonzero, this is not possible.
\end{myexample}

It is worth noticing that the pullback condition on associativity is not equivalent to the localized independence property: recall that a zero measure always displays conditional independence of all its outputs (\Cref{zeromeasure}).
Therefore, for zero measures, the localized independence property is always trivially valid, even for the cases (like the example above) where the pullback property fails.

For now it is an open question whether the localized independence property for a Kleisli category is reflected by an equivalent condition on the monad.


\section{Conclusions and future work}
Our main result (\Cref{mainthm}) establishes a tight correspondence between algebraic properties of $T1$ and the universal properties of certain commutative squares given by the structural arrows of $T$, for a given monad on a cartesian category.

Therefore, we believe that our main theorem suggests at least three potential directions for future research:
\begin{itemize}
\item generalizing the statement to weakly affine monads on weakly Markov categories;
\item enhancing the study of monads through a purely algebraic approach, i.e., studying the properties of $T1$;
\item studying the properties of monads in terms of suitable pullbacks.
\end{itemize} 
We will provide further details on these potential directions in the following:

\textbf{Regarding possible generalizations:} in \Cref{mainthm}, we provide a characterization of weakly affine monads on cartesian monoidal categories. Taking inspiration from the case of affine monads on Markov categories, it seems natural to consider whether our main result can be extended to monads on \emph{weakly Markov categories}.

However, solving this problem is non-trivial and requires clever adjustments to the main definitions. The crucial point is that, in general, the structure of the internal group of $T1$ and the structure of the group $\mD(X,T1)$ are not necessarily related in the current definitions. One approach could be to introduce a form of \emph{compatibility} for $T1$ and $\mD(X,T1)$ by defining weakly affine monad on a weakly Markov category as a monad such that $T1$ is an internal group and $\mD(X,T1)$ is a group with the composition and inverses induced by those of $T1$. With this change, for example, \Cref{weaklyboth} would work for any weakly Markov category, but \Cref{mainthm}  would likely fail as its proof involves the universal property of products. 

\textbf{Further on algebraic structures:}
this work delves into properties of monads that can be described purely in algebraic terms concerning the (internal) structure of $T1$, introducing a generalization of the notion of affine monad. 
We introduced a generalization of the concept of affine monad, providing insight into potential interesting families of monads lying between weakly affine monads (where $T1$ is a group), and affine monads (where $T1$ is the trivial group $1$).
For example, we can consider weakly affine monads such that the diagram
% https://q.uiver.app/?q=WzAsNCxbMCwwLCJUKDEpIl0sWzAsMSwiVCgxKSJdLFsxLDEsIlReMigxKSJdLFsxLDAsIlQoMSkiXSxbMCwxLCJcXGlvdGEiLDJdLFsxLDIsIlQoXFxldGFfMSkiLDJdLFswLDNdLFszLDIsIlxcZXRhX3tUMX0iXV0=
\[\begin{tikzcd}
	{T(1)} & {T(1)} \\
	{T(1)} & {T^2(1)}
	\arrow["\iota"', from=1-1, to=2-1]
	\arrow["{T(\eta_1)}"', from=2-1, to=2-2]
	\arrow["\id",from=1-1, to=1-2]
	\arrow["{\eta_{T1}}", from=1-2, to=2-2]
\end{tikzcd}\]
commutes. It is straightforward to check that when the previous diagram commutes then:
\begin{enumerate}
	\item $T^2(1)\cong T(1)$ in $\mD$. 
	\item the internal group $T(1)$ has exponent $2$, namely $\iota=\id_{T1}$;
	\item the group $\mathrm{Kl}_T(X,1)$ has exponent $2$.
\end{enumerate}
We believe that continuing this approach, defining studying new monads based on the algebraic properties of $T1$ could lead to the development of new and interesting tools for applications in categorical probability.

%\todo[inline]{T: Having a nontrivial example of this statement would help to motivate and illustrate it. Like this, its meaning and significance remains quite unclear}
% 
%\begin{proof}
%	To prove the first claim, it is enough to show that $T(1)\cong 1$ in the Kleisli category $\mathrm{Kl}_T$.
%	By weak affinity, $T(1)$ is a group in $\mD$, where the arrow $\freccia{1}{\eta_1}{T(1)}$ is the unit of the group and $\freccia{T(1)}{\iota}{T(1)}$ is the inversion map. Therefore, we have that the composition $\freccia{1}{\iota\eta_1}{T(1)}$ has to be equal to $\eta_1$.
%	Hence we can consider the arrows $1\to T(1)$ and $T(1)\to 1$ in the Kleisli category $\mathrm{Kl}_T$ represented by $T(\eta_1)\eta_1$ and $\iota$, respectively. The composition $T(\eta_1)\eta_1$ with $\iota$ in $\mathrm{Kl}_T$ is given by $\mu_{1,1}T(\iota)T(\eta_1)\eta_1$. Employing the naturality of $\eta_1$ and the fact that $\iota\eta_1=\eta_1$, it is direct to check that $\mu T(\iota)T(\eta_1)\eta_1=\eta_1$, that is the identity $1\to 1$ in $\mathrm{Kl}_T$. Now to show that the other composition gives the identity on $T(1)$ in $\mathrm{Kl}_T$, it is enough to show that $T(\eta_1)\iota=\eta_{T(1)}$, but this follows by hypothesis.
%
%	For the second claim, we can compose the diagram with the monad multiplication, obtaining $\iota=\id_{T1}$.
%	
%	The last claim follows by combining the second one with the explicit construction of inverses in $\mathrm{Kl}_T(X,1)$ (see the proof of \Cref{weaklyboth}).
%\end{proof}

\textbf{More on pullbacks conditions:}
in \Cref{mainthm} we  demonstrate that the algebraic properties of $T1$ can be (equivalently) recovered by studying suitable pullbacks involving structural morphism. Hence, \Cref{mainthm}  presents a second possible approach to investigate the properties of monads  studying when certain commutative squares involving structural morphisms are pullbacks.

Recall that Bart Jacobs calls a strong monad $T$ on a cartesian monoidal category \emph{strongly affine}~\cite{Jacobs16} if for every pair of objects $X$ and $Y$, the following diagram is a pullback,
 \[
  \begin{tikzcd}
   X \times TY \ar{d}{\pi_1} \ar{r}{s} & T(X\times Y) \ar{d}{T\pi_1} \\
   X \ar{r}{\eta} & TX
  \end{tikzcd}
 \]
where $s$ denotes the strength and $\eta$ denotes the unit of the monad. Every strongly affine monad is affine. 
The corresponding condition on the (Markov) category $\mathrm{Kl}_T$ is called \emph{positivity}~\cite[Section~2]{fritz2022dilations}.

Note that for a generic commutative monad, the diagram above may even fail to commute (take for example the measure monad $M$, and start with $(x,0)$ in the top left corner). One can however consider the following diagram, which reduces to the one above (up to isomorphism) in the affine case,
\[
 \begin{tikzcd}
   X \times TY \ar{d}{\id\times T!} \ar{r}{s} & T(X\times Y) \ar{d}{T(\id\times!)} \\
   X \times T1 \ar{r}{s} & T(X\times 1) \cong TX
  \end{tikzcd}
\]
and which always commutes by naturality of the strength.
One can then call the monad $T$ \emph{positive} if this second diagram is a pullback (and possibly define \emph{positive gs-monoidal categories} analogously to positive Markov categories). 



\bibliography{biblio_davide}



\end{document}


