\documentclass[a4paper,UKenglish,numberwithinsect,cleveref, autoref, thm-restate]{lipics-v2021}




%\usepackage{natbib}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{float}
\usepackage{amsfonts}
\usepackage{amssymb}
\include{macro_davide}
\usepackage{mathtools}
\usepackage{quiver}
\usepackage{cleveref}
\usepackage{hyperref}
\usepackage{xcolor}
\usepackage[all,2cell]{xy}
\UseAllTwocells
\xyoption{v2}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{tikz}
\usepackage{tikzit}

\usetikzlibrary{shapes}

%\input{sample.tikzstyle}
\usepackage{freetikz}
\usetikzlibrary{decorations.markings,positioning,patterns}
\usetikzlibrary{shadows}
\usepackage{array}

%\usetikzlibrary{automata, positioning, arrows}
\input{stringdiagrams.tikzstyles}
\usepackage{todonotes}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\theoremstyle{plain} %italico
\newtheorem{mytheorem}{Theorem}[section]
\newtheorem{mycorollary}[mytheorem]{Corollary}
\newtheorem{mylemma}[mytheorem]{Lemma}
\newtheorem{myproposition}[mytheorem]{Proposition}


\theoremstyle{definition} %stampatello
\newtheorem{mydefinition}[mytheorem]{Definition}
\newtheorem{myproblem}[mytheorem]{Problem}

\newtheorem{myremark}[mytheorem]{Remark}
\newtheorem{myexample}[mytheorem]{Example}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\stringdiagnabla}[1]{\begin{tikzpicture}[scale=0.60, transform shape]
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (-4.25, 0) {};
		\node [style=none] (1) at (-2.75, 0.5) {};
		\node [style=none] (2) at (-2.75, -0.5) {};
		\node [style=none] (3) at (-2, -0.5) {};
		\node [style=none] (4) at (-2, 0.5) {};
		\node [style=nodonero] (5) at (-3.25, 0) {};
		\node [style=none] (7) at (-3.75, 0.25) {#1};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (5);
		\draw [bend left, looseness=1.25] (5) to (1.center);
		\draw (1.center) to (4.center);
		\draw [bend right] (5) to (2.center);
		\draw (2.center) to (3.center);
	\end{pgfonlayer}
	\pgfsetbaseline{-0.4ex}
\end{tikzpicture}}


\newcommand{\stringdiagbang}[1]{\begin{tikzpicture}[scale=0.60, transform shape]
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (8) at (2, 0) {};
		\node [style=nodonero] (9) at (3, 0) {};
		\node [style=none] (10) at (2.5, 0.25) {#1};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (8.center) to (9);
	\end{pgfonlayer}
		\pgfsetbaseline{-.4ex}
\end{tikzpicture}}

\newcommand{\stringdiagidentity}[1]{\begin{tikzpicture}[scale=0.60, transform shape]
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (8) at (2, 0) {};
		\node [style=none] (9) at (3, 0) {};
		\node [style=none] (10) at (2.5, 0.25) {#1};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (8.center) to (9);
	\end{pgfonlayer}
		\pgfsetbaseline{-.4ex}
\end{tikzpicture}}
\newcommand{\stringdiagfreccia}[3]{\begin{tikzpicture}[scale=0.60, transform shape]
	\begin{pgfonlayer}{nodelayer}
		\node [style=box] (5) at (1.75, 0) {#2};
		\node [style=none] (7) at (3, 0) {};
		\node [style=none] (8) at (2.5, 0.25) {#3};
		\node [style=none] (9) at (0.5, 0) {};
		\node [style=none] (10) at (1, 0.25) {#1};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (5) to (7);
		\draw (9.center) to (5);
	\end{pgfonlayer}
	\pgfsetbaseline{-.4ex}
\end{tikzpicture}
}
\newcommand{\nodo}{\begin{tikzpicture}[scale=0.60, transform shape]
	\begin{pgfonlayer}{nodelayer}
		\node [style=nodonero] (0) at (0, 0) {};
	\end{pgfonlayer}
	\pgfsetbaseline{-.4ex}
\end{tikzpicture}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\title{Weakly-affine monads}
\titlerunning{Weakly-affine monads}

\author{Paolo Perrone}{Department of Computer Science, University of Oxford}{paolo.perrone.math@gmail.com}{ }{}
\author{Fabio Gadducci}{Department of Computer Science, University of Pisa, Pisa, IT}{fabio.gadducci@unipi.it}{ https://orcid.org/
0000-0003-0690-3051}{}
\author{ Davide Trotta }{Department of Computer Science, University of Pisa, Pisa, IT}{trottadavide92@gmail.com}{https://orcid.org/0000-0003-4509-594X}{}
\authorrunning{F. Gadducci et alii}
%The research is supported by the MIUR PRIN 2017FTXR "IT-MaTTerS"

\Copyright{Fabio Gadducci and Paolo Perrone and Davide Trotta} 
\ccsdesc[500]{}


\keywords{string diagrams, gs-monoidal categoriess} %TODO mandatory; please add comma-separated list of keywords

\begin{document}

\maketitle

\begin{abstract}
To be written.
\end{abstract}

\section{Weakly Markov categories}

Let $\mC$ be a GS-category. For every object $X$, the set $\mC(X,I)$ 
\todo{How to call them? effects? co-states?}
has a canonical commutative monoid structure as follows: the monoidal unit is the discard map $X\to I$, and given $a,b:X\to I$, their product $ab$ is given by copying, as follows.
\ctikzfig{ptwise-product}
If a morphism $f:X\to Y$ is copyable and discardable, precomposition with $f$ induces a morphism of monoids $\mC(Y,I)\to\mC(X,I)$. 

The monoid $\mC(X,I)$ acts on the set $\mC(X,Y)$: given $a:X\to I$ and $f:X\to Y$, $a\cdot f$ is given as follows,
\ctikzfig{action}
and the product $(f,g)\mapsto (f\otimes g)\circ\mathrm{copy}_X$ is equivariant for this action. 

\begin{mydefinition}
 A GS-category $\mC$ is called \emph{weakly Markov} if for every object $X$, the monoid $\mC(X,I)$ is a group. 
\end{mydefinition}

Every Markov category is weakly Markov: for each $X$, the monoid $\mC(X,I)$ is the trivial group.

\begin{mydefinition}
 Given two parallel morphisms $f,g:X\to Y$ in a weakly Markov GS-category $\mC$, we say that $f$ and $g$ are \emph{equivalent}, and write $f\sim g$, if they lie in the same orbit for the action of $\mC(X,I)$, i.e.~if there is $a\in \mC(X,I)$ such that $a\cdot f=g$.
 We say they are \emph{uniquely equivalent} if there is a unique $a\in \mC(X,I)$ such that $a\cdot f=g$.
\end{mydefinition}


Let's now consider the case where the GS structure comes from a commutative monad on a cartesian monoidal category $\mD$. 
In this case, the monoid structure of Kleisli morphisms $X\to 1$ comes from the following canonical internal monoid structure of $T1$ in $\mD$, given by 
 \[
 \begin{tikzcd}
  1 \ar{r}{\eta} & T1 ,
 \end{tikzcd}
 \qquad
 \begin{tikzcd}
  T1 \times T1 \ar{r}{c} & T(1\times 1) \ar{r}{\cong} & T1 .
 \end{tikzcd}
 \]
 The monoid structure of Kleisli morphisms $X\to 1$ is now given as follows. The unit is given by
 \[
 \begin{tikzcd}
  X \ar{r}{!} & 1 \ar{r}{\eta} & T1 ,
 \end{tikzcd}
 \]
 and the multiplication of the morphisms $f^\sharp,g^\sharp:X\to T1$ is
 \[
 \begin{tikzcd}
  X \ar{r}{\mathrm{copy}} & X\times X \ar{r}{f^\sharp\times g^\sharp} &
  T1 \times T1 \ar{r}{c} & T(1\times 1) \ar{r}{\cong} & T1 .
 \end{tikzcd}
 \]
\todo{mi sembra che la proposizione 1.7 funzioni in generale per con $\mD$ GS, no?}



\begin{mydefinition}
 A commutative monad $T$ on a cartesian monoidal category is called \emph{weakly affine} if $T1$ with its canonical internal monoid structure is a group.
\end{mydefinition}


\begin{myproposition}\label{weaklyboth}
 Let $\mD$ be a cartesian monoidal category, and let $T$ be a commutative monad on $\mD$. The Kleisli category of $T$ is weakly Markov if and only if $T$ is weakly affine.
\end{myproposition}
\begin{proof}
 First, suppose that $T1$ is an internal group, and denote by $\iota:T1\to T1$ its inversion map. 
 The inverse of the morphism $f^\sharp:X\to T1$ in $\mathrm{Kl}_T(X,1)$ is given by $\iota\circ f$: indeed, the following diagram commutes,
 \[
  \begin{tikzcd}
  X \ar{d}[swap]{f^\sharp} \ar{r}{\mathrm{copy}} & X\times X \ar{d}[swap]{f^\sharp\times f^\sharp} \ar{dr}{f\times(\iota\circ f)} \\
  T1 \ar{d}[swap]{!} \ar{r}{\mathrm{copy}} & T1\times T1 \ar{r}[swap]{\id\times\iota} & T1\times T1 \ar{r}{c} & T(1\times 1) \ar{d}{\cong} \\
  1 \ar{rrr}{\eta} &&& T1
  \end{tikzcd}
 \]
 where the bottom rectangle commutes since $\iota$ is the inversion map for $T1$. The analogous diagram with $\iota\times\id$ in place of $\id\times\iota$ commutes analogously.
 
 Conversely, suppose that for every $X$, the monoid structure on $\mathrm{Kl}_T(X,1)$ has inverses. Then in particular we can take $X=T1$, and the inverse of the Kleisli morphism $\id:T1\to T1$ is an inversion map for $T1$. 
\end{proof}

\todo[inline]{This feels vaguely like Yoneda, but in monoidal sauce. Can't make it precise for now.}


\subsection{Conditional independence in weakly Markov categories}

\begin{mydefinition}\label{defcondind}
 A morphism $f:A\to X_1\otimes\dots\otimes X_n$ in a A GS-category $\mC$ is said to exhibit \emph{conditional independence of the $X_i$ given $A$} if and only if it can be expressed as a product of the following form.
 \ctikzfig{cond-ind-sep}
\end{mydefinition}

Note that this is slightly different from \cite[Definition~6.6]{cho_jacobs_2019}, although it is equivalent for the case of Markov categories.

\begin{myproposition}\label{eqcondind}
 Let $f:A\to X_1\otimes\dots\otimes X_n$ be a morphism in a GS-category $\mC$. Then $f$ exhibits conditional independence of the $X_i$ given $A$ if and only if it is equivalent to the product of all its marginals.
 Moreover, in that case $f$ is \emph{uniquely} equivalent to the product of its marginals.
\end{myproposition}

This generalizes the fact that, in Markov categories, a distribution exhibiting conditional independence is the product of its marginals~\cite[Section~12]{Fritz_2020}.

\begin{proof}
 Denote the marginals of $f$ by $f_1,\dots,f_n$.
 Suppose that $f$ is a product as in \Cref{defcondind}. For each $i=1,\dots,n$, by marginalizing, we get that $f_i$ is equal to the following.
  \ctikzfig{cond-ind-proof} 
 Therefore for each $i$ we have that $f_i\sim g_i$. 
 
 Conversely, suppose that $f$ is equivalent to the product of its marginals, i.e.~that there exists $a:X\to I$ such that $f$ is equal to the following.
 \ctikzfig{cond-ind-proof2}
 One can then choose $g_i=f_i$ for all $i<n$, and $g_n = a\cdot f_n$, so that $f$ is in the form of \Cref{defcondind}.
 Moreover, by marginalizing over all the $X_i$ at once, we see that 
 \ctikzfig{cond-ind-proof3}
 so that $a$ is uniquely determined.
\end{proof} 
 
\begin{myremark}
 For $n=2$, a morphism $f:A\to X\otimes Y$ in a weakly Markov GS-category $\mC$ exhibits conditional independence of $X$ and $Y$ given $A$ 
 if and only if the following equation holds.
 \ctikzfig{cond-ind2} 
\end{myremark}


\begin{mylemma}\label{indepkleisli}
 Let $\mD$ be a cartesian monoidal category, and let $T$ be a commutative monad on $\mD$.
 A Kleisli morphism $f^\sharp:A\to T(X_1\times\dots\times X_n)$ exhibits conditional independence of the $X_i$ given $A$ if and only if it factors as follows
 \[
 \begin{tikzcd}
  A \ar{d}[swap]{(g_1^\sharp,\dots,g_n^\sharp)} \ar{dr}{f^\sharp} \\
  TX_1\times\dots\times TX_n \ar{r}[swap]{c} & T(X_1\times\dots\times X_n) ,
 \end{tikzcd}
 \]
 for some Kleisli maps $g_i^\sharp:A\to TX_i$,
 where the map $c$ above is the one obtained by iterating the multiplication of the monoidal structure (such a map is unique by associativity). 
\end{mylemma}
\begin{proof}
 In terms of the base category $\mD$, a Kleisli morphism in the form of \Cref{defcondind} reads as follows.
 \[
  \begin{tikzcd}[sep=large]
   A \ar{r}{\mathrm{copy}} & A\times\dots\times A \ar{r}{g_1^\sharp\times\dots\times g_n^\sharp} & TX_1\times\dots\times TX_n \ar{r}{c} & T(X_1\times\dots\times X_n) .
  \end{tikzcd}
 \]
 Therefore $f^\sharp:A\to T(X_1\times\dots\times X_n)$ is exhibiting conditional independence if and only if it is in the form above.
\end{proof}



\begin{mydefinition}
 Let $\mC$ be a GS-category. We say that $\mC$ satisfies the \emph{localized independence property} if whenever a morphism 
 $f:A\to X\otimes Y\otimes Z$ exhibits conditional independence of $X\otimes Y$ (jointly) and $Z$ given $A$, as well as conditional independence of $X$ and $Y\otimes Z$ given $A$, then it exhibits conditional independence of $X$, $Y$ and $Z$ given $A$. 
\end{mydefinition}


\begin{mytheorem}
 Let $\mD$ be a cartesian monoidal category, and let $T$ be a commutative monad on $\mD$.
 The following conditions are equivalent.
 \begin{enumerate}
  \item\label{condgroup} $T$ is weakly affine;
  \item\label{condwm} $\mathrm{Kl}(T)$ is weakly Markov;
  \item\label{condlocal} $\mathrm{Kl}(T)$ satisfies the localized independence property;
  \item\label{condpullback} For all objects $X$, $Y$, and $Z$, the following associativity diagram is a pullback.
	\begin{equation}
		\label{assoc_pullback}
		\hspace{-9pt}	% T: for centering the equation number
		\begin{tikzcd}[column sep=3.3pc]
			T(X) \times T(Y) \times T(Z) \ar{r}{\id \times c_{Y,Z}} \ar[swap]{d}{c_{X,Y} \times \id}	& T(X) \times T(Y \times Z) \ar{d}{c_{X,Y \times Z}}	\\
			T(X \times Y) \times T(Z) \ar{r}{c_{X\times Y,Z}}						& T(X \times Y \times Z)
		\end{tikzcd}
	\end{equation}
 \end{enumerate}
\end{mytheorem}

\begin{proof}
 $\ref{condgroup}\Leftrightarrow\ref{condwm}$: 
 see \Cref{weaklyboth}.
 
 $\ref{condwm}\Rightarrow\ref{condlocal}$: 
 Suppose $f:A\to X\otimes Y\otimes Z$ exhibits conditional independence of $X\otimes Y$ (jointly) and $Z$ given $A$, as well as conditional independence of $X$ and $Y\otimes Z$ given $A$
 By marginalizing out $X$, we have that $f_{YZ}$ exhibits conditional independence of $Y$ and $Z$ given $A$. 
 Since by hypothesis $f$ exhibits conditional independence of $X$ and $Y\otimes Z$ given $A$, by \Cref{eqcondind} we have that $f$ is equivalent to the product  of $f_X$ and $f_{YZ}$. But, again by \Cref{eqcondind}, $f_{YZ}$ is equivalent to the product of $f_Y$ and $f_Z$, so we have that $f$ is equivalent to the product of all its marginals. Using \Cref{eqcondind} in the other direction, thie means that $f$ exhibits conditional independence of $X$, $Y$ and $Z$ given $A$. 
 
 $\ref{condlocal}\Rightarrow\ref{condpullback}$: 
 By the universal property of products, a cone over the cospan in \eqref{assoc_pullback} consists of maps $g_1^\sharp:A\to TX$, $g_{23}^\sharp:A\to T(Y\times Z)$, $g_{12}^\sharp:A\to T(X\times Y)$ and $g_3^\sharp:A\to TZ$ such that the following diagram commutes. 
 \[
  \begin{tikzcd}[column sep=3.3pc]
   A \ar[bend left=10]{drr}{(g_1^\sharp,g_{23}^\sharp)} \ar[bend right=15]{ddr}[swap]{(g_{12}^\sharp,g_3^\sharp)} \\
   & T(X) \times T(Y) \times T(Z) \ar{r}[swap]{\id \times c_{Y,Z}} \ar{d}{c_{X,Y} \times \id}	& T(X) \times T(Y \times Z) \ar{d}{c_{X,Y \times Z}}	\\
   & T(X \times Y) \times T(Z) \ar{r}[swap]{c_{X\times Y,Z}}						& T(X \times Y \times Z)
  \end{tikzcd}
 \]
 By \Cref{indepkleisli}, this amounts to a Kleisli map $f^\sharp:A\to T(X\times Y\times Z)$ exhibiting conditional independence of $X$ and $Y\otimes Z$ given $A$, as well as of $X\otimes Y$ and $Z$ given $A$. By \Cref{condlocal}, we then have that $f$ exhibits conditional independence of all $X$, $Y$ and $Z$ given $A$, and so, again by \Cref{indepkleisli}, $f^\sharp$ factors through the product $TX\times TY\times TZ$. 
 More specifically, by marginalizing over $Z$, we have that $g_{12}^\sharp$ factors through $TX\times TY$, i.e.~the following diagram on the left commutes for some $h_1^\sharp:A\to TX$ and $h_2^\sharp:A\to TY$, and similarly, by marginalizing over $X$, the diagram on the right commutes for some $\ell_2^\sharp:A\to TY$ and $\ell_3^\sharp:A\to TZ$.
 \[
  \begin{tikzcd}
   A \ar{d}[swap]{(h_1^\sharp,h_2^\sharp)} \ar{dr}{g_{12}^\sharp} \\
   TX\times TY \ar{r}[swap]{c} & T(X\times Y) 
  \end{tikzcd}
  \qquad
  \begin{tikzcd}
   A \ar{d}[swap]{(\ell_2^\sharp,\ell_3^\sharp)} \ar{dr}{g_{23}^\sharp} \\
   TY\times TZ \ar{r}[swap]{c} & T(Y\times Z) 
  \end{tikzcd}
 \]
 In other words, the upper and the left curved triangles in the following diagram commute.
\[
  \begin{tikzcd}[column sep=3.3pc]
   A \ar[bend left=15, shift left]{drr}{(g_1^\sharp,g_{23}^\sharp)} \ar[bend right=35]{ddr}[swap]{(g_{12}^\sharp,g_3^\sharp)} 
    \ar[shift left]{dr}[near end]{(g_1^\sharp,\ell_2^\sharp,\ell_3^\sharp)} \ar[shift right]{dr}[swap, pos=0.7]{(h_1^\sharp,h_2^\sharp, g_3^\sharp)} \\
   & T(X) \times T(Y) \times T(Z) \ar{r}[swap]{\id \times c_{Y,Z}} \ar{d}{c_{X,Y} \times \id}	& T(X) \times T(Y \times Z) \ar{d}{c_{X,Y \times Z}}	\\
   & T(X \times Y) \times T(Z) \ar{r}[swap]{c_{X\times Y,Z}}						& T(X \times Y \times Z)
  \end{tikzcd}
 \]
 By marginalizing over $Y$ and $Z$, there exists a unique $a^\sharp:A\to T1$ such that $h_1 = a\cdot g_1$. 
 Therefore
 \[
  g_{12} = h_1\cdot h_2 = (a\cdot g_1) \cdot h_2 = g_1\cdot (a\cdot h_2) ,
 \]
 and so in the diagram above we can equivalently replace $h_1$ and $h_2$ with $g_1$ and $a\cdot h_2$.
 Similarly by marginalizing over $X$ and $Y$, there exists a unique $c^\sharp:A\to T1$ such that $\ell_3=c\cdot g_3$, so that
 \[
  g_{23}= \ell_2\cdot\ell_3 = \ell_2\cdot (c\cdot g_3) = (c\cdot \ell_2) \cdot g_3
 \]
 and in the diagram above we can replace $\ell_2$ and $\ell_3$ with $c\cdot \ell_2$ and $g_3$, as follows.
 \[
  \begin{tikzcd}[column sep=3.3pc]
   A \ar[bend left=15, shift left]{drrr}{(g_1^\sharp,g_{23}^\sharp)} \ar[bend right=35]{ddrr}[swap]{(g_{12}^\sharp,g_3^\sharp)} 
    \ar[shift left]{drr}[near end]{(g_1^\sharp,(c\cdot\ell_2)^\sharp,g_3^\sharp)} \ar[shift right]{drr}[swap, pos=0.8]{(g_1^\sharp,(a\cdot h_2)^\sharp, g_3^\sharp)} \\
   && T(X) \times T(Y) \times T(Z) \ar{r}[swap]{\id \times c_{Y,Z}} \ar{d}{c_{X,Y} \times \id}	& T(X) \times T(Y \times Z) \ar{d}{c_{X,Y \times Z}}	\\
   && T(X \times Y) \times T(Z) \ar{r}[swap]{c_{X\times Y,Z}}						& T(X \times Y \times Z)
  \end{tikzcd}
 \]
 Now, marginalizing over $Z$ and $Z$, we see that necessarily $a\cdot h_2=c\cdot \ell_2$. 
 Therefore there is a unique map $A\to TX\times TY\times TZ$ making the whole diagram commute, which means that \eqref{assoc_pullback} is a pullback.
 
 $\ref{condpullback}\Rightarrow\ref{condgroup}$:
 If $T$ is weakly affine, then taking $X = Y = Z = 1$ in~\eqref{assoc_pullback} shows that this monoid must be an abelian group: we obtain a unique arrow $\freccia{T(1)}{\iota}{T(1)}$ making the following diagram commute,
	\[
		\begin{tikzcd}
			T1 \ar{dr}[description]{(\id,\iota,\id)} \ar[bend left=15]{drr}{(\id,\eta_1 !)} \ar[bend right,swap]{ddr}{(\eta_1 !,\id)} \\
			&	T1 \times T1 \times T1 \ar{r}{\id \times c_{1,1}} \ar[swap]{d}{c_{1,1} \times \id}	& T1 \times T(1\times 1) \ar{d}{c_{1,1\times 1}} \ar{r}{\cong} & T1\times T1 \ar{d}{c_{1,1}}	\\
			&	T(1\times 1) \times T1 \ar{r}{c_{1\times 1,1}} \ar{d}[swap]{\cong}	& T(1\times 1\times 1) \ar{d}{\cong} \ar{r}{\cong} & T(1\times 1) \ar{d}{\cong} \\
			& T1\times T1 \ar{r}[swap]{c_{1,1}} & T(1\times 1) \ar{r}[swap]{\cong} & T1
		\end{tikzcd}
	\]
	and the commutativity shows that $\iota$ satisfies the equations making it the inversion map for a group structure.
\end{proof}



% For context:
% \begin{myproposition}
%  A monoid $(M,\cdot,1)$ is a group if and only if the associativity square
%  \begin{equation}\label{assoc}
%   \begin{tikzcd}
%    M \times M \times M \ar{d}{\id\times\cdot} \ar{r}{\cdot\times\id} & M\times M \ar{d}{\cdot} \\
%    M\times M \ar{r}{\cdot} & M
%   \end{tikzcd}
%  \end{equation}
%  is a pullback.
% \end{myproposition}
% \begin{proof}
%  The square~\eqref{assoc} is a pullback, both of sets and of groups, if and only if given $a,g,h,c\in M$ such that $ag=hc$, there exists a unique $b\in M$ such that $g=bc$ and $h=ab$.
%  First, suppose that $g$ is a group. The only possible choice of $b$ is 
%  \[
%   b = a^{-1}h = gc^{-1},
%  \]
%  which is unique by uniqueness of inverses. 
%  
%  Conversely, suppose that \eqref{assoc} is a pullback. We can set $g,h=e$ and $c=a$ so that $ae=ea=a$. 
%  Instantiating the pullback property, there is a unique $b$ such that $ab=e$ and $ba=e$, that is, $b=a^{-1}$.
% \end{proof}


\section{Additional material (to be added to section)}

\begin{myproposition}\label{prop:actio_group_as_pullback}
 Let $(G,\cdot,1)$ be a group and let $X$ be a set. A function $\alpha: M\times X\to X$ determines a left action if and only if the square
 \begin{equation}\label{action}
  \begin{tikzcd}
   G \times G \times X \ar{d}{\id\times\alpha} \ar{r}{\cdot\times\id} & M\times X \ar{d}{\alpha} \\
   G\times X \ar{r}{\alpha} & X
  \end{tikzcd}
 \end{equation}
 commutes and it is a pullback.
\end{myproposition}
\begin{proof}
By definition, the square \eqref{action} commutes if and only if $\alpha$ and $\cdot$ are compatible. Now we show that the commutative square \eqref{action} is a pullback if and only if $\alpha$ satisfies the identity axiom, i.e. $\alpha(e,x)=x$ for every $x$ in $X$.
Now, if \eqref{action} is a pullback, then there exists a function $\beta:X\to G$ such that the diagram
% https://q.uiver.app/?q=WzAsNSxbMSwxLCJNXFx0aW1lcyBNXFx0aW1lcyBYIl0sWzMsMSwiTVxcdGltZXMgWCJdLFsxLDMsIk1cXHRpbWVzIFgiXSxbMywzLCJYIl0sWzAsMCwiIFgiXSxbMCwxLCJpZFxcdGltZXMgXFxhbHBoYSJdLFswLDIsIlxcY2RvdFxcdGltZXMgaWQiLDJdLFsyLDMsIlxcYWxwaGEiLDJdLFsxLDMsIlxcYWxwaGEiXSxbNCwyLCJlISxpZCIsMix7ImN1cnZlIjo1fV0sWzQsMSwiZSEsaWQiLDAseyJjdXJ2ZSI6LTV9XSxbNCwwLCJlISxcXGJldGEsaWQiLDFdXQ==
\[\begin{tikzcd}
	{ X} \\
	& {G\times G\times X} && {G\times X} \\
	\\
	& {G\times X} && X
	\arrow["{id\times \alpha}", from=2-2, to=2-4]
	\arrow["{\cdot\times id}"', from=2-2, to=4-2]
	\arrow["\alpha"', from=4-2, to=4-4]
	\arrow["\alpha", from=2-4, to=4-4]
	\arrow["\angbr{e!}{\id}"', curve={height=30pt}, from=1-1, to=4-2]
	\arrow["\angbr{e!}{\id}", curve={height=-30pt}, from=1-1, to=2-4]
	\arrow["\angbr{e!}{\beta,\id}"{description}, from=1-1, to=2-2]
\end{tikzcd}\]
commutes, where $e!:X\to G$ is the function assigning the identity element $e$ to every element $x$ of $X$. Now, since the left triangle commutes, then we have that $e=e\cdot \beta (x)$ for every $x$ of $X$, i.e. $\beta(x)=e$ for every $x$ of $X$. Now, since the right triangle commutes, we can conclude that $\alpha (\beta(x),x)=\alpha (e,x)=x$ for every $x$ in $X$. 

Now we show that $\alpha (e,x)=x$ implies that  the commutative square \eqref{action} is a pullback. Let us consider a set $Y$ and the functions $\angbr{f_1}{f_2}:Y\to G\times X$ and  $\angbr{g_1}{g_2}:Y\to G\times X$ such that $\alpha( f_1(y),f_2(y))=\alpha( g_1(y),g_2(y))$. By applying $\alpha (f_1(y)^{-1},-)$ to both sides, and then combining the compatibility of $\alpha$ with the assumption that $\alpha (e,x)=x$, we can conclude that $f_2(y)=\alpha (f_1(y)^{-1}\cdot g_1(y),g_2(y))$.
%similarly, that $g_2(y)=\alpha (g_1(y)^{-1}\cdot f_1(y),f_2(y))$. 
Therefore, we can conclude that the diagram 
% https://q.uiver.app/?q=WzAsNSxbMSwxLCJNXFx0aW1lcyBNXFx0aW1lcyBYIl0sWzMsMSwiTVxcdGltZXMgWCJdLFsxLDMsIk1cXHRpbWVzIFgiXSxbMywzLCJYIl0sWzAsMCwiIFkiXSxbMCwxLCJpZFxcdGltZXMgXFxhbHBoYSJdLFswLDIsIlxcY2RvdFxcdGltZXMgaWQiLDJdLFsyLDMsIlxcYWxwaGEiLDJdLFsxLDMsIlxcYWxwaGEiXSxbNCwyLCJnXzEuZ18yIiwyLHsiY3VydmUiOjV9XSxbNCwxLCJmXzEsZl8yIiwwLHsiY3VydmUiOi01fV0sWzQsMCwiZl8xLGZfMV57LTF9Z18xLGdfMiIsMV1d
\[\begin{tikzcd}
	{ Y} \\
	& {M\times M\times X} && {M\times X} \\
	\\
	& {M\times X} && X
	\arrow["{id\times \alpha}", from=2-2, to=2-4]
	\arrow["{\cdot\times id}"', from=2-2, to=4-2]
	\arrow["\alpha"', from=4-2, to=4-4]
	\arrow["\alpha", from=2-4, to=4-4]
	\arrow["\angbr{g_1}{g_2}"', curve={height=30pt}, from=1-1, to=4-2]
	\arrow["\angbr{f_1}{f_2}", curve={height=-30pt}, from=1-1, to=2-4]
	\arrow["\angbr{f_1}{\gamma,g_2}"{description}, from=1-1, to=2-2]
\end{tikzcd}\]
commutes, where the function $\gamma: Y \to M$ is defined by $\gamma (y):= f_1^{-1}(y)\cdot g_1 (y)$. By the unicity of the inverse in a group, this function is also unique, and hence we can conclude that the commutative square \eqref{action} is a pullback.
\end{proof}
\section{Weakly-affine monads}
\todo{Nome da scegliere e valutare se dare la def per una arbitraria gs}
\begin{mydefinition}
Let $T$ be a commutative monad on a category $\mA$ with finite products. A triple $(X,Y,Z)$ of objects of $\mA$ is said to be \textbf{TBA} if the commutative square 
\[\begin{tikzcd}[column sep=3.3pc]
			T(X) \times T(Y) \times T(Z) \ar{r}{\id \times c_{Y,Z}} \ar[swap]{d}{c_{X,Y} \times \id}	& T(X) \times T(Y \times Z) \ar{d}{c_{X,Y \times Z}}	\\
			T(X \times Y) \times T(Z) \ar{r}{c_{X\times Y,Z}}						& T(X \times Y \times Z)
		\end{tikzcd}
		\]
		is a pullback.
\end{mydefinition}

\todo{esempi?}
\begin{mydefinition}
	Let $T$ be a commutative monad on a category $\mA$ with finite products. 
	We say that the monad $T$ is \textbf{weakly affine} if the
	following associativity diagram is a pullback for every $X,Y,Z$ in $\mA$:
	\begin{equation}
		\label{c_assoc_pullback}
		\hspace{-9pt}	% T: for centering the equation number
		\begin{tikzcd}[column sep=3.3pc]
			T(X) \times T(Y) \times T(Z) \ar{r}{\id \times c_{Y,Z}} \ar[swap]{d}{c_{X,Y} \times \id}	& T(X) \times T(Y \times Z) \ar{d}{c_{X,Y \times Z}}	\\
			T(X \times Y) \times T(Z) \ar{r}{c_{X\times Y,Z}}						& T(X \times Y \times Z)
		\end{tikzcd}
	\end{equation}
\end{mydefinition}

Let us derive some general properties before looking at examples.
It is a standard fact that for any commutative monad $T$, the composite arrow
\[
	\begin{tikzcd}
		T(1) \times T(1) \ar{r}{c_{1,1}}	& T(1 \times 1) \ar{r}{\cong}	& T(1)		
	\end{tikzcd}
\]
equips $T(1)$ with the structure of a commutative monoid internal to $\mathcal{A}$ with unit $\freccia{1}{\eta_1}{T(1)}$.

\begin{mylemma}\label{lem_T1_group}
	\label{lem:T1_group}
	If $T$ is weakly affine, then $T(1)$ is a group.
\end{mylemma}

%\tob{It's possible to generalize the definition of weakly affine monad to the case where $\mA$ is merely gs-monoidal or even just symmetric monoidal. However, I have not implemented this (yet) since already the proof of this lemma does not generalize straightforwardly}

\begin{proof}
	If $T$ is weakly affine, then taking $X = Y = Z = 1$ in~\eqref{c_assoc_pullback} shows that this monoid must be an abelian group:
	assuming that $\times$ is a strict monoidal structure for simplicity, we obtain a unique arrow $\freccia{T(1)}{\iota}{T(1)}$ such that the diagram
	\[
		\begin{tikzcd}
			T(1) \ar{dr}[description]{(\id,\iota,\id)} \ar[bend left]{drr}{(\id,\eta_1 !)} \ar[bend right,swap]{ddr}{(\eta_1 !,\id)} \\
			&	T(1) \times T(1) \times T(1) \ar{r}{\id \times c_{1,1}} \ar[swap]{d}{c_{1,1} \times \id}	& T(1) \times T(1) \ar{d}{c_{1,1}}	\\
			&	T(1) \times T(1) \ar{r}{c_{1,1}}								& T(1)
		\end{tikzcd}
	\]
	and the commutativity shows that $\iota$ satisfies the equations making it the inversion map for a group structure.
\end{proof}

\begin{myproposition}
	\label{lem:group_action}
	If $T$ is weakly affine, then for every object $X$, the morphism $c_{1,X}: T(1)\times T(X)\to T(X)$ determines a (left) group action. 

\end{myproposition}
\begin{proof}
%Let $\freccia{T(X)}{\gamma}{T(X)}$ be the unique morphism such that the diagram
%	\[
%		\begin{tikzcd}
%			T(X) \ar{dr}[description]{(\eta_1!,\gamma,\eta_1!)} \ar[bend left]{drr}{(\eta_1!,\id)} \ar[bend right,swap]{ddr}{(\id,\eta_1!)} \\
%			&	T(1) \times T(X) \times T(1) \ar{r}{\id \times c_{X,1}} \ar[swap]{d}{c_{1,X} \times \id}	& T(1) \times T(X) \ar{d}{c_{1,X}}	\\
%			&	T(X) \times T(1) \ar{r}{c_{X,1}}								& T(X)
%		\end{tikzcd}
%	\]
%	commutes. Now we show that the morphism $c_{1,X}\circ (\id_{T1}\times \gamma): T(1)\times T(X)\to T(X)$ provides an action of the group $T(1)$ on $T(X)$. First, notice that identity axiom, i.e. $(c_{1,X} (\id_{T1}\times \gamma))(\eta_1!, \id)=\id$, is satisfied by definition of $\gamma$, because $c_{1,X}(\eta_1!,\gamma)=\id$. 
	The compatibility axiom follows from the fact that the diagram
	% https://q.uiver.app/?q=WzAsNCxbMCwwLCJUKDEpXFx0aW1lcyBUKDEpXFx0aW1lcyBUKFgpIl0sWzIsMCwiVCgxKVxcdGltZXMgVChYKSJdLFsyLDEsIlQoWCkiXSxbMCwxLCJUKDEpXFx0aW1lcyBUKFgpIl0sWzAsMSwiaWRcXHRpbWVzIGNfezEsWH0iXSxbMSwyLCJjX3sxLFh9Il0sWzAsMywiY197MSwxfVxcdGltZXMgaWQiLDJdLFszLDIsImNfezEsWH0iLDJdXQ==
\[\begin{tikzcd}
	{T(1)\times T(1)\times T(X)} && {T(1)\times T(X)} \\
	{T(1)\times T(X)} && {T(X)}
	\arrow["{\id\times c_{1,X}}", from=1-1, to=1-3]
	\arrow["{c_{1,X}}", from=1-3, to=2-3]
	\arrow["{c_{1,1}\times \id}"', from=1-1, to=2-1]
	\arrow["{c_{1,X}}"', from=2-1, to=2-3]
\end{tikzcd}\]
commutes for every strong and commutative monad. Moreover, following the same proof used for \Cref{prop:actio_group_as_pullback}, we can conclude that the identity axiom is satisfied since $T$ is weakly affine. In particular, because $T(1)$ is a group by \Cref{lem_T1_group}, and the previous square is a pullbackc (by definition of weakly affine monad).
\end{proof}


\begin{myproposition}
Let $T$ be a weakly affine monad. If the diagram
% https://q.uiver.app/?q=WzAsNCxbMCwwLCJUKDEpIl0sWzAsMSwiVCgxKSJdLFsxLDEsIlReMigxKSJdLFsxLDAsIlQoMSkiXSxbMCwxLCJcXGlvdGEiLDJdLFsxLDIsIlQoXFxldGFfMSkiLDJdLFswLDNdLFszLDIsIlxcZXRhX3tUMX0iXV0=
\[\begin{tikzcd}
	{T(1)} & {T(1)} \\
	{T(1)} & {T^2(1)}
	\arrow["\iota"', from=1-1, to=2-1]
	\arrow["{T(\eta_1)}"', from=2-1, to=2-2]
	\arrow["\id",from=1-1, to=1-2]
	\arrow["{\eta_{T1}}", from=1-2, to=2-2]
\end{tikzcd}\]
commutes, then $T^2(1)\cong T(1)$ in $\mA$. 

\end{myproposition}
\begin{proof}
	To prove the result it is enough to show that $T(1)\cong 1$ in the Kleisli category $\mA_T$.
We know from Lemma~\label{lem:T1_group} that $T(1)$ is a group in $\mA$, where the arrow $\freccia{1}{\eta_1}{T(1)}$ is the unit of the group, and $\freccia{T(1)}{\iota}{T(1)}$ is the inversion map. Therefore, we have that the composition $\freccia{1}{\iota\eta_1}{T(1)}$ has to be equal to $\eta_1$. Therefore, we can consider the arrows $1\to T(1)$ and $T(1)\to 1$ in the Kleisli category $\mA_T$ given by $T(\eta_1)\eta_1$ and $\iota$ respectively. The composition $T(\eta_1)\eta_1$ with $\iota$ in $\mA_T$ is given by $\mu_{1,1}T(\iota)T(\eta_1)\eta_1$. Employing the naturality of $\eta_1$ and the fact that $\iota\eta_1=\eta_1$, it is direct to check that $\mu T(\iota)T(\eta_1)\eta_1=\eta_1$, that is the identity $1\to 1$ in $\mA_T$. Now to show that the other composition gives the identity on $T(1)$ in $\mA_T$, it is enough to show that $T(\eta_1)\iota=\eta_{T(1)}$, but this follows by hypothesis.
\end{proof}
\todo[inline]{(Paolo) Credo che $T(\eta_1)\iota\ne\eta_{T(1)}$ nell'esempio delle misure nonzero. Per ogni $x$ in $(0,\infty)=T1$ abbiamo che $\eta_{T(1)}(x)=\delta_x$ (delta di Dirac), mentre $T\eta_1(\iota(x)) = T\eta_1(1/x) = 1/x\,\delta_1$.}
\begin{mycorollary}
	Let $T$ be a weakly affine monad. If the diagram
	% https://q.uiver.app/?q=WzAsNCxbMCwwLCJUKDEpIl0sWzAsMSwiVCgxKSJdLFsxLDEsIlReMigxKSJdLFsxLDAsIlQoMSkiXSxbMCwxLCJcXGlvdGEiLDJdLFsxLDIsIlQoXFxldGFfMSkiLDJdLFswLDNdLFszLDIsIlxcZXRhX3tUMX0iXV0=
	\[\begin{tikzcd}
		{T(1)} & {T(1)} \\
		{T(1)} & {T^2(1)}
		\arrow["\iota"', from=1-1, to=2-1]
		\arrow["{T(\eta_1)}"', from=2-1, to=2-2]
		\arrow["\id",from=1-1, to=1-2]
		\arrow["{\eta_{T1}}", from=1-2, to=2-2]
	\end{tikzcd}\]
	commutes, then $T(1)$ is an idempotent group, namely $\iota=\id_{T1}$.
\end{mycorollary}
\begin{proof}
By \Cref{lem_T1_group} we have that $T(1)$ is a group. If $\eta_{T1}=T(\eta_{1})\iota$, then  we can apply the multiplication of the monad to both sides, obtaining $\iota=\id_{T1}$.
\end{proof}
The following result shows that weak affinity occurs frequently. 
Recall that a strong monad $\freccia{\mA}{T}{\mA}$ on a category $\mA$ with finite products is \textbf{affine} if $T(1)\cong 1$ (see also Remark~\ref{rem:affine monad}). Three relevant examples of affine monads are the distribution monad on $\Set$ (for discrete probability), the Giry monad on the category of measurable spaces (for measure-theoretic probability, see Examples~\ref{ex: Giry monad} and~\ref{ex:Stoch and QBS_P are gs-monoidal}), and the expectation monad, see~\cite{Jacobs16}.

\begin{myproposition}\label{prop:every affine commutative monad is weakly affine}
	Let $T$ be a commutative monad on a category $\mA$ with finite limits. 
	If $T$ is affine, then it is weakly affine.
\end{myproposition}


\begin{proof}
	Let $m_{X,Y} : T(X \times Y) \longrightarrow TX \times TY$
	be the arrow defined as the pairing of $T(\pi_1)$ and $T(\pi_2)$.
	Then it is known that $T$ is affine if and only if $m_{X,Y} c_{X,Y} = \id_{TX \times TY}$~\cite[Lemma~4.2(i)]{Jacobs1994}.\footnote{For probability monads, this equation can be interpreted as stating that the marginals of a product distribution are the original factors~\cite{Fritz2018}.}
	In particular, $c_{X,Y}$ is a split mono and therefore mono.

	To show that~\eqref{c_assoc_pullback} is a pullback, we prove the universal property starting with a diagram
	\begin{equation}
		\label{candidate_pullback}
		\begin{tikzcd}[column sep=3pc]
			A \ar[bend left]{drr}{(f_1, f_2)} \ar[bend right,swap]{ddr}{(g_1, g_2)} \ar[dashed]{dr}{\exists!}							\\
				& TX \times TY \times TZ \ar{r}{\id \times c_{Y,Z}} \ar[swap]{d}{c_{X,Y} \times \id}	& TX \times T(Y \times Z) \ar{d}{c_{X,Y \times Z}}	\\
				& T(X \times Y) \times TZ \ar{r}{c_{X\times Y,Z}}						& T(X \times Y \times Z)
		\end{tikzcd}
	\end{equation}
	where the dashed arrow will be constructed; its uniqueness is clear since $\id \times c_{Y,Z}$ and $c_{X,Y} \times \id$ are mono, so it remains to prove existence.
	Taking the unlabelled arrows to be (induced by) product projections, we have the commutative diagram
	\iffalse
	\[
		\begin{tikzcd}[column sep=small]
			A \ar{r}{(g_1, g_2)} \ar[swap]{d}{(f_1, f_2)}					& T(X \times Y) \times TZ \ar{r}{c_{X \times Y, Z}} 	& T(X \times Y \times Z) \ar{d}	\\
			TX \times T(Y \times Z) \ar{rr}	\ar["c_{X,Y \times Z}" description]{urr} 	&							& T(Y \times Z)
		\end{tikzcd}
	\]
	\fi
% https://q.uiver.app/?q=WzAsNSxbMCwwLCJBIl0sWzEsMCwiVChYXFx0aW1lcyBZKVxcdGltZXMgVFoiXSxbMCwxLCJUWFxcdGltZXMgVChZXFx0aW1lcyBaKSJdLFszLDAsIlQoWFxcdGltZXMgWVxcdGltZXMgWikiXSxbMywxLCJUKFlcXHRpbWVzIFopIl0sWzAsMSwiKGdfMSxnXzIpIl0sWzAsMiwiKGZfMSxmXzIpIiwyXSxbMyw0XSxbMiw0XSxbMiwzLCJjX3tYLFlcXHRpbWVzIFp9IiwxXSxbMSwzXV0=
\[\begin{tikzcd}[column sep=tiny]
	A & {T(X\times Y)\times TZ} && {T(X\times Y\times Z)} \\
	{TX\times T(Y\times Z)} &&& {T(Y\times Z)}
	\arrow["{(g_1,g_2)}", from=1-1, to=1-2]
	\arrow["{(f_1,f_2)}"', from=1-1, to=2-1]
	\arrow[from=1-4, to=2-4]
	\arrow[from=2-1, to=2-4]
	\arrow["{c_{X,Y\times Z}}"{description}, from=2-1, to=1-4]
	\arrow[from=1-2, to=1-4]
\end{tikzcd}\]
	where the upper left triangle commutes by assumption, and the lower right triangle commutes by naturality of $c$ with respect to the unique arrow $X \to 1$ together with $T1 \cong 1$ and the fact that $c_{1,Y \times Z}$ is a coherence isomorphism.
	By the naturality of $c$, $f_2$ can be written as the composite
	\[
		\begin{tikzcd}[column sep=scriptsize]
			A \ar{r}{(g_1, g_2)}	& T(X \times Y) \times TZ \ar{r}	& TY \times TZ \ar{r}{c_{Y,Z}}	& T(Y \times Z).			
		\end{tikzcd}
	\]
	By analogous reasoning, we identify $g_1$ with the composite
	\[
		\begin{tikzcd}[column sep=scriptsize]
			A \ar{r}{(f_1, f_2)}	& TX \times T(Y \times Z) \ar{r}	& TX \times TY \ar{r}{c_{X,Y}}	& T(X \times Y).			
		\end{tikzcd}
	\]
	Getting back to~\eqref{candidate_pullback}, we take the dashed arrow to be the arrow whose component on $TX$ is given by $f_1$, on $TZ$ by $g_2$, and on $TY$ by the diagonal in the diagram
	\[
		\begin{tikzcd}
			A \ar{r}{f_2} \ar[swap]{d}{g_1}	& T(Y \times Z)	\ar{d}	\\
			T(X \times Y) \ar{r}		& TY
		\end{tikzcd}
	\]
	which commutes for similar reasons as above.
	The fact that this arrow recovers the $f_2$ component after composition with $\id \times c_{Y,Z}$ and the $g_1$ component after composition with $c_{X,Y} \times \id$ follows by the expressions for $f_2$ and $g_1$ derived above.
	The fact that it recovers $f_1$ and $g_2$ is by construction.

\end{proof}

\begin{myremark}
	We are not aware of any relation between weakly affine monads in our sense and Jacobs' \emph{strongly affine} monads~\cite{Jacobs16}, other than the fact that strongly affine implies affine implies weakly affine.
\end{myremark}

\begin{myexample}
	\label{ex:abelian_group}
	We present a family of examples of commutative monads that are weakly affine but not affine.
	Let $A$ be an abelian group (written multiplicatively).
	Then the functor $T_A \coloneqq A \times -$ on $\Set$ has a canonical structure of commutative monad, 
	where the lax structure components $c_{X,Y}$ are given by multiplying elements in $A$ while carrying the elements 
	of $X$ and $Y$ along.

	Since $T_A \cong A$, the monad $T_A$ is clearly not affine unless $A$ is the trivial group.
	However, $T_A$ is always weakly affine.
	Indeed, in order to show that~\eqref{c_assoc_pullback} is a pullback, it suffices to show that the associativity square of $A$
	\[
		\begin{tikzcd}
			A \times A \times A \ar{r}{\id \times \cdot} \ar{d}{\cdot \times \id}		& A \times A \ar{d}{\cdot}	\\
			A \times A \ar{r}{\cdot}							& A
		\end{tikzcd}
	\]
	is a pullback.
	Using element-wise reasoning, this amounts to showing that the system of equations
		$ax = c$ and $xb = d$
	has a solution for $x \in A$ if and only if $cb = ad$, and in this case the solution is unique.
	But this is indeed the case with $x = a^{-1} c = db^{-1}$.
	(Note that this argument does not even require $A$ to be abelian, but we need to require this in order for $T_A$ to be commutative.)
\end{myexample}

\begin{myexample}
	Many monads in categorical measure theory are weakly affine but not affine.
	Let e.g. $M^* : \Set \to \Set$ be the monad assigning to every set the set of finitely supported discrete \emph{nonzero}
	measures on $M^*$, or equivalently let $M^*(X)$ for any set $X$ be the set of nonzero finitely supported functions $X \to [0,\infty)$.
	The monad structure is defined in terms of the same formulas as for the distribution monad on $\Set$ and the
	components $c_{X,Y}$ are also given by the formation of product measures, or equivalently point-wise products of functions 
	$X \to [0,\infty)$.

	Since $M^* 1 \cong (0,\infty)$, this monad is clearly not affine.
	However, it is weakly affine, and we limit ourselves to a sketch of the proof.
	Indeed to prove that~\eqref{c_assoc_pullback} is a pullback, we again reason in terms of elements.
	If all measures are normalised, then we are back in the situation of the distribution monad, which is affine and the claim follows.
	In the general case, one can reduce to the normalised case by showing that the normalisation of the desired element of $M^*(Y)$ is uniquely determined.
	This works in the same way as in Example~\ref{ex:abelian_group} with $A = (0,\infty)$.

	On the other hand, if the zero measure is included, then we obtain a commutative monad $M$ which can be seen as the monad of semimodules for the semiring of nonnegative reals.
	Since $M1 \cong [0,\infty)$ is not a group under multiplication, $M$ is not weakly affine.
\end{myexample}

The previous two examples and Lemma~\ref{lem:T1_group} suggest the following problem.

\begin{myproblem}
	Let $T$ be a commutative monoid such that $T(1)$ is an abelian group. Does it follow that $T$ is weakly affine?
\end{myproblem}


\end{document}


